<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comida con Despensa - Yachay Mikuy</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-blue: #2c5aa0;
            --light-blue: #5d8cc4;
            --dark-blue: #1a3a6e;
            --success-green: #28a745;
            --success-green-dark: #218838;
            --accent-orange: #ff9800;
            --accent-orange-dark: #e08e0b;
            --accent-purple: #6f42c1;
            --accent-purple-dark: #5a32a3;
            --accent-teal: #20c997;
            --accent-teal-dark: #1aa27d;
            --accent-pink: #d63384;
            --accent-pink-dark: #b02a6e;
            --accent-cyan: #0dcaf0;
            --accent-cyan-dark: #0baccc;
            --gray: #6c757d;
            --light-gray: #f8f9fa;
            --white: #ffffff;
            --shadow-color: rgba(40, 50, 70, 0.1);
            --danger-red: #dc3545;
            --danger-red-dark: #c82333;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeOut {
            from { opacity: 1; transform: translateY(0); }
            to { opacity: 0; transform: translateY(-20px); }
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Montserrat', sans-serif;
        }

        body {
            background-image: linear-gradient(120deg, #f5f9ff 0%, #e6f0fa 100%);
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header Styles */
        .header {
            background: var(--white);
            border-radius: 20px;
            box-shadow: 0 8px 30px var(--shadow-color);
            padding: 25px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 8px solid var(--success-green);
        }

        .header-content {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .header-icon {
            font-size: 2.5rem;
            color: var(--success-green);
        }

        .header-title h1 {
            color: var(--dark-blue);
            font-size: 2rem;
            font-weight: 800;
            margin-bottom: 5px;
        }

        .header-title p {
            color: var(--gray);
            font-size: 1.1rem;
        }

        .header-actions {
            display: flex;
            gap: 15px;
        }

        .btn {
            padding: 10px 20px;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
            transition: all 0.3s ease;
            border: none;
        }

        .btn-primary {
            background: linear-gradient(45deg, var(--primary-blue), var(--light-blue));
            color: var(--white);
            box-shadow: 0 4px 15px rgba(44, 90, 160, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(44, 90, 160, 0.4);
        }

        .btn-danger {
            background: linear-gradient(45deg, var(--danger-red), #e85d75);
            color: var(--white);
            box-shadow: 0 4px 15px rgba(220, 53, 69, 0.3);
        }

        .btn-danger:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(220, 53, 69, 0.4);
        }

        /* Children Tags */
        .children-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .child-tag {
            background-color: rgba(93, 140, 196, 0.1);
            color: var(--primary-blue);
            padding: 5px 12px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* Instructions Section */
        .instructions {
            background: var(--white);
            border-radius: 20px;
            box-shadow: 0 8px 30px var(--shadow-color);
            margin-bottom: 30px;
            overflow: hidden;
        }

        .instructions-header {
            padding: 20px;
            background: rgba(40, 167, 69, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }

        .instructions-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--success-green);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .instructions-toggle {
            font-size: 1.2rem;
            color: var(--success-green);
            transition: transform 0.3s ease;
        }

        .instructions-content {
            padding: 0 20px;
            max-height: 500px;
            overflow: hidden;
            transition: max-height 0.5s ease, padding 0.5s ease;
        }

        .instructions-content.collapsed {
            max-height: 0;
            padding: 0 20px;
        }

        .instructions-steps {
            list-style: none;
            counter-reset: step-counter;
            padding: 20px 0;
        }

        .instructions-steps li {
            counter-increment: step-counter;
            margin-bottom: 15px;
            padding-left: 40px;
            position: relative;
        }

        .instructions-steps li::before {
            content: counter(step-counter);
            position: absolute;
            left: 0;
            top: 0;
            width: 30px;
            height: 30px;
            background-color: var(--success-green);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        /* Food Input Section */
        .food-input {
            background: var(--white);
            border-radius: 20px;
            box-shadow: 0 8px 30px var(--shadow-color);
            padding: 25px;
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--dark-blue);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--light-gray);
        }

        .tab {
            padding: 12px 20px;
            font-weight: 600;
            color: var(--gray);
            cursor: pointer;
            position: relative;
            transition: color 0.3s ease;
        }

        .tab.active {
            color: var(--success-green);
        }

        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 100%;
            height: 3px;
            background-color: var(--success-green);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .manual-input {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .ingredient-input {
            flex: 1;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .ingredient-input:focus {
            outline: none;
            border-color: var(--success-green);
        }

        .autocomplete-list {
            position: absolute;
            width: 100%;
            max-height: 200px;
            overflow-y: auto;
            background: var(--white);
            border: 1px solid #ddd;
            border-radius: 0 0 10px 10px;
            z-index: 10;
            display: none;
        }

        .autocomplete-item {
            padding: 10px 15px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .autocomplete-item:hover {
            background-color: var(--light-gray);
        }

        .photo-upload {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            padding: 30px;
            border: 2px dashed #ddd;
            border-radius: 15px;
            background-color: rgba(40, 167, 69, 0.05);
        }

        .photo-icon {
            font-size: 3rem;
            color: var(--success-green);
        }

        .photo-text {
            font-size: 1.2rem;
            color: var(--gray);
            text-align: center;
        }

        .file-input {
            display: none;
        }

        .ingredients-list {
            margin-top: 20px;
        }

        .ingredient-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            background-color: var(--light-gray);
            border-radius: 10px;
            margin-bottom: 10px;
            animation: fadeIn 0.3s ease;
        }

        .ingredient-name {
            font-weight: 500;
        }

        .btn-remove {
            background: none;
            border: none;
            color: var(--danger-red);
            cursor: pointer;
            font-size: 1.2rem;
            transition: transform 0.2s ease;
        }

        .btn-remove:hover {
            transform: scale(1.2);
        }

        .btn-save {
            width: 100%;
            padding: 15px;
            background: linear-gradient(45deg, var(--success-green), #58c271);
            color: var(--white);
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
            transition: all 0.3s ease;
            margin-top: 20px;
        }

        .btn-save:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
        }

        /* Recipe Generation Section */
        .recipe-generation {
            background: var(--white);
            border-radius: 20px;
            box-shadow: 0 8px 30px var(--shadow-color);
            padding: 25px;
            margin-bottom: 30px;
        }

        .meal-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .btn-meal {
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s ease;
        }

        .btn-breakfast {
            background: linear-gradient(45deg, var(--accent-orange), var(--accent-orange-dark));
            color: var(--white);
        }

        .btn-lunch {
            background: linear-gradient(45deg, var(--success-green), var(--success-green-dark));
            color: var(--white);
        }

        .btn-dinner {
            background: linear-gradient(45deg, var(--accent-purple), var(--accent-purple-dark));
            color: var(--white);
        }

        .btn-dessert {
            background: linear-gradient(45deg, var(--accent-pink), var(--accent-pink-dark));
            color: var(--white);
        }

        .btn-meal:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
        }

        /* Recipe Display Section */
        .recipe-display {
            background: var(--white);
            border-radius: 20px;
            box-shadow: 0 8px 30px var(--shadow-color);
            padding: 25px;
        }

        .recipe-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
        }

        .recipe-card {
            background: var(--white);
            border-radius: 15px;
            box-shadow: 0 5px 15px var(--shadow-color);
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            animation: fadeIn 0.5s ease;
            position: relative;
        }

        .recipe-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .recipe-header {
            padding: 15px 20px;
            background: linear-gradient(45deg, var(--light-blue), var(--primary-blue));
            color: var(--white);
            position: relative;
        }

        .recipe-title {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .recipe-type {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .btn-copy {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255, 255, 255, 0.2);
            color: var(--white);
            border: none;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .btn-copy:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .recipe-body {
            padding: 20px;
        }

        .recipe-section {
            margin-bottom: 20px;
        }

        .recipe-section:last-child {
            margin-bottom: 0;
        }

        .section-subtitle {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--dark-blue);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .ingredient-list, .steps-list {
            padding-left: 20px;
        }

        .ingredient-list li, .steps-list li {
            margin-bottom: 8px;
        }

        .tips-box {
            background-color: rgba(40, 167, 69, 0.1);
            border-left: 4px solid var(--success-green);
            padding: 15px;
            border-radius: 0 10px 10px 0;
            margin-bottom: 20px;
        }

        .benefits-box {
            background-color: rgba(93, 140, 196, 0.1);
            border-left: 4px solid var(--primary-blue);
            padding: 15px;
            border-radius: 0 10px 10px 0;
            margin-bottom: 20px;
        }

        .allergy-box {
            background-color: rgba(220, 53, 69, 0.1);
            border-left: 4px solid var(--danger-red);
            padding: 15px;
            border-radius: 0 10px 10px 0;
        }

        /* Loading Spinner */
        .spinner-container {
            display: none;
            justify-content: center;
            align-items: center;
            height: 200px;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(40, 167, 69, 0.2);
            border-radius: 50%;
            border-top-color: var(--success-green);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 100;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: var(--white);
            border-radius: 15px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            animation: fadeIn 0.3s ease;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--dark-blue);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--gray);
            cursor: pointer;
        }

        .modal-body {
            margin-bottom: 25px;
            color: var(--gray);
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }

            .header-actions {
                width: 100%;
                justify-content: center;
            }

            .recipe-grid {
                grid-template-columns: 1fr;
            }

            .meal-buttons {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="header-icon">
                    <i class="fas fa-shopping-basket"></i>
                </div>
                <div class="header-title">
                    <h1>Comida con Despensa</h1>
                    <p>Panel Familiar</p>
                    <div class="children-tags" id="childrenTags">
                        <!-- Se llenará dinámicamente -->
                    </div>
                </div>
            </div>
            <div class="header-actions">
                <a href="yachay.html" class="btn btn-primary">
                    <i class="fas fa-arrow-left"></i> Volver al Panel
                </a>
                <a href="index.html" class="btn btn-danger">
                    <i class="fas fa-sign-out-alt"></i> Salir
                </a>
            </div>
        </header>

        <!-- Instructions Section -->
        <section class="instructions">
            <div class="instructions-header" id="instructionsToggle">
                <div class="instructions-title">
                    <i class="fas fa-info-circle"></i> Instrucciones
                </div>
                <div class="instructions-toggle" id="instructionsIcon">
                    <i class="fas fa-chevron-up"></i>
                </div>
            </div>
            <div class="instructions-content" id="instructionsContent">
                <ol class="instructions-steps">
                    <li>Agrega tus ingredientes (manual o por foto).</li>
                    <li>Guarda tu despensa.</li>
                    <li>Genera tus recetas personalizadas.</li>
                </ol>
            </div>
        </section>

        <!-- Food Input Section -->
        <section class="food-input">
            <h2 class="section-title">
                <i class="fas fa-utensils"></i> Ingreso de Alimentos
            </h2>
            
            <div class="tabs">
                <div class="tab active" data-tab="manual">Entrada Manual</div>
                <div class="tab" data-tab="photo">Carga por Foto</div>
            </div>
            
            <div class="tab-content active" id="manual-tab">
                <div class="manual-input">
                    <div style="position: relative; flex: 1;">
                        <input type="text" id="ingredientInput" class="ingredient-input" placeholder="Añade un ingrediente...">
                        <div class="autocomplete-list" id="autocompleteList"></div>
                    </div>
                    <button id="addIngredientBtn" class="btn btn-primary">
                        <i class="fas fa-plus"></i> Agregar
                    </button>
                </div>
                
                <div class="ingredients-list" id="ingredientsList"></div>
            </div>
            
            <div class="tab-content" id="photo-tab">
                <div class="photo-upload">
                    <div class="photo-icon">
                        <i class="fas fa-camera"></i>
                    </div>
                    <p class="photo-text">Sube una foto de tu despensa para identificar automáticamente los ingredientes</p>
                    <button id="uploadPhotoBtn" class="btn btn-primary">
                        <i class="fas fa-cloud-upload-alt"></i> Subir foto de mi despensa
                    </button>
                    <input type="file" id="fileInput" class="file-input" accept="image/*">
                </div>
            </div>
            
            <button id="savePantryBtn" class="btn-save">
                <i class="fas fa-save"></i> Guardar mi Despensa
            </button>
        </section>

        <!-- Recipe Generation Section -->
        <section class="recipe-generation">
            <h2 class="section-title">
                <i class="fas fa-magic"></i> Generación de Recetas
            </h2>
            
            <div class="meal-buttons">
                <button class="btn-meal btn-breakfast" data-meal="desayuno">
                    <i class="fas fa-coffee"></i> Generar Desayuno
                </button>
                <button class="btn-meal btn-lunch" data-meal="almuerzo">
                    <i class="fas fa-hamburger"></i> Generar Almuerzo
                </button>
                <button class="btn-meal btn-dinner" data-meal="cena">
                    <i class="fas fa-moon"></i> Generar Cena
                </button>
                <button class="btn-meal btn-dessert" data-meal="postre">
                    <i class="fas fa-ice-cream"></i> Generar Postre
                </button>
            </div>
        </section>

        <!-- Recipe Display Section -->
        <section class="recipe-display">
            <h2 class="section-title">
                <i class="fas fa-book-open"></i> Recetas Generadas
            </h2>
            
            <div class="spinner-container" id="spinnerContainer">
                <div class="spinner"></div>
            </div>
            
            <div class="recipe-grid" id="recipeGrid"></div>
        </section>
    </div>

    <!-- Modal -->
    <div class="modal" id="confirmModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Confirmar acción</h3>
                <button class="modal-close" id="modalClose">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body" id="modalBody">
                ¿Estás seguro de que quieres realizar esta acción?
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="modalCancel">Cancelar</button>
                <button class="btn btn-danger" id="modalConfirm">Confirmar</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Cargar datos de todos los niños desde localStorage
            const storedData = localStorage.getItem('yachayMikuyChildren');
            
            if (!storedData) {
                document.body.innerHTML = '<h1>Error: No se encontraron datos de niños.</h1>';
                return;
            }
            
            const allChildrenData = JSON.parse(storedData);
            // Filtrar para usar solo los perfiles que han completado el cuestionario
            const completedChildren = allChildrenData.filter(child => child.completed);

            if (completedChildren.length === 0) {
                document.body.innerHTML = '<h1>No hay perfiles completados. Por favor, finalice al menos un cuestionario para continuar.</h1>';
                return;
            }

            // Mostrar etiquetas de niños en la cabecera
            const childrenTags = document.getElementById('childrenTags');
            completedChildren.forEach(child => {
                const childTag = document.createElement('span');
                childTag.className = 'child-tag';
                childTag.innerHTML = `<i class="fas fa-child"></i> ${child.name}`;
                childrenTags.appendChild(childTag);
            });
            
            // Lista de alimentos comunes ricos en hierro para autocompletado
            const ironRichFoods = [
                "Carne de res", "Pollo", "Pescado", "Huevo", "Espinaca", 
                "Lentejas", "Garbanzos", "Frijoles", "Tofu", "Quinoa",
                "Avena", "Cereales fortificados", "Pasta fortificada", "Pan integral",
                "Hígado", "Mollejas", "Sardinas", "Atún", "Salmón",
                "Brócoli", "Col rizada", "Acelga", "Remolacha", "Tomate",
                "Pimiento rojo", "Naranja", "Fresa", "Kiwi", "Papaya",
                "Mango", "Piña", "Guayaba", "Ciruela", "Manzana",
                "Plátano", "Aguacate", "Yogur", "Leche fortificada", "Queso"
            ];
            
            // Cargar ingredientes guardados previamente
            let ingredients = [];
            const savedIngredients = localStorage.getItem('familyPantry');
            if (savedIngredients) {
                ingredients = JSON.parse(savedIngredients);
                renderIngredients();
            }
            
            // Configurar tabs
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    // Desactivar todas las tabs y contenidos
                    tabs.forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    
                    // Activar la tab seleccionada y su contenido
                    this.classList.add('active');
                    const tabId = this.getAttribute('data-tab');
                    document.getElementById(`${tabId}-tab`).classList.add('active');
                });
            });
            
            // Configurar instrucciones colapsables
            const instructionsToggle = document.getElementById('instructionsToggle');
            const instructionsContent = document.getElementById('instructionsContent');
            const instructionsIcon = document.getElementById('instructionsIcon');
            
            instructionsToggle.addEventListener('click', function() {
                instructionsContent.classList.toggle('collapsed');
                
                if (instructionsContent.classList.contains('collapsed')) {
                    instructionsIcon.innerHTML = '<i class="fas fa-chevron-down"></i>';
                } else {
                    instructionsIcon.innerHTML = '<i class="fas fa-chevron-up"></i>';
                }
            });
            
            // Configurar autocompletado
            const ingredientInput = document.getElementById('ingredientInput');
            const autocompleteList = document.getElementById('autocompleteList');
            
            ingredientInput.addEventListener('input', function() {
                const value = this.value.toLowerCase();
                autocompleteList.innerHTML = '';
                
                if (value.length < 2) {
                    autocompleteList.style.display = 'none';
                    return;
                }
                
                const filteredFoods = ironRichFoods.filter(food => 
                    food.toLowerCase().includes(value)
                );
                
                if (filteredFoods.length > 0) {
                    autocompleteList.style.display = 'block';
                    
                    filteredFoods.forEach(food => {
                        const item = document.createElement('div');
                        item.classList.add('autocomplete-item');
                        item.textContent = food;
                        item.addEventListener('click', function() {
                            ingredientInput.value = food;
                            autocompleteList.style.display = 'none';
                        });
                        autocompleteList.appendChild(item);
                    });
                } else {
                    autocompleteList.style.display = 'none';
                }
            });
            
            // Cerrar autocompletado al hacer clic fuera
            document.addEventListener('click', function(e) {
                if (e.target !== ingredientInput) {
                    autocompleteList.style.display = 'none';
                }
            });
            
            // Agregar ingrediente
            const addIngredientBtn = document.getElementById('addIngredientBtn');
            addIngredientBtn.addEventListener('click', function() {
                const value = ingredientInput.value.trim();
                if (value) {
                    // Verificar si el ingrediente ya existe
                    if (!ingredients.includes(value)) {
                        ingredients.push(value);
                        renderIngredients();
                        ingredientInput.value = '';
                        autocompleteList.style.display = 'none';
                    } else {
                        alert('Este ingrediente ya está en tu lista.');
                    }
                }
            });
            
            // Agregar ingrediente al presionar Enter
            ingredientInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    addIngredientBtn.click();
                }
            });
            
            // Renderizar lista de ingredientes
            function renderIngredients() {
                const ingredientsList = document.getElementById('ingredientsList');
                ingredientsList.innerHTML = '';
                
                if (ingredients.length === 0) {
                    ingredientsList.innerHTML = '<p style="text-align: center; color: var(--gray);">No hay ingredientes agregados aún.</p>';
                    return;
                }
                
                ingredients.forEach((ingredient, index) => {
                    const item = document.createElement('div');
                    item.classList.add('ingredient-item');
                    item.innerHTML = `
                        <span class="ingredient-name">${ingredient}</span>
                        <button class="btn-remove" data-index="${index}">
                            <i class="fas fa-times"></i>
                        </button>
                    `;
                    ingredientsList.appendChild(item);
                });
                
                // Configurar botones de eliminar
                document.querySelectorAll('.btn-remove').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const index = parseInt(this.getAttribute('data-index'));
                        ingredients.splice(index, 1);
                        renderIngredients();
                    });
                });
            }
            
            // Configurar carga de foto
            const uploadPhotoBtn = document.getElementById('uploadPhotoBtn');
            const fileInput = document.getElementById('fileInput');
            
            uploadPhotoBtn.addEventListener('click', function() {
                fileInput.click();
            });
            
            fileInput.addEventListener('change', function() {
                if (this.files && this.files[0]) {
                    // Simular procesamiento de imagen
                    alert('Función de reconocimiento de imágenes en desarrollo. Por ahora, añade los ingredientes manualmente.');
                }
            });
            
            // Guardar despensa
            const savePantryBtn = document.getElementById('savePantryBtn');
            savePantryBtn.addEventListener('click', function() {
                localStorage.setItem('familyPantry', JSON.stringify(ingredients));
                
                // Mostrar confirmación
                const modal = document.getElementById('confirmModal');
                const modalBody = document.getElementById('modalBody');
                modalBody.textContent = `¡Tu despensa con ${ingredients.length} ingredientes ha sido guardada correctamente!`;
                modal.style.display = 'flex';
                
                // Configurar botones del modal
                document.getElementById('modalCancel').style.display = 'none';
                document.getElementById('modalConfirm').textContent = 'Aceptar';
                document.getElementById('modalConfirm').onclick = function() {
                    modal.style.display = 'none';
                    document.getElementById('modalCancel').style.display = 'block';
                    document.getElementById('modalConfirm').textContent = 'Confirmar';
                };
            });
            
            // Configurar botones de generación de recetas
            const mealButtons = document.querySelectorAll('.btn-meal');
            mealButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const mealType = this.getAttribute('data-meal');
                    generateRecipe(mealType);
                });
            });
            
            // Función para generar recetas (simulación)
            function generateRecipe(mealType) {
                const spinnerContainer = document.getElementById('spinnerContainer');
                const recipeGrid = document.getElementById('recipeGrid');
                
                // Mostrar spinner
                spinnerContainer.style.display = 'flex';
                recipeGrid.style.display = 'none';
                
                // Simular llamada a API
                setTimeout(() => {
                    // Ocultar spinner
                    spinnerContainer.style.display = 'none';
                    recipeGrid.style.display = 'grid';
                    
                    // Generar receta de ejemplo
                    const newRecipe = generateExampleRecipe(mealType);
                    
                    // Obtener recetas existentes
                    let recipes = [];
                    const savedRecipes = localStorage.getItem('familyRecipes');
                    if (savedRecipes) {
                        recipes = JSON.parse(savedRecipes);
                    }
                    
                    // Añadir nueva receta
                    recipes.push(newRecipe);
                    
                    // Limitar a 6 recetas
                    if (recipes.length > 6) {
                        recipes.shift(); // Eliminar la más antigua
                    }
                    
                    // Guardar recetas
                    localStorage.setItem('familyRecipes', JSON.stringify(recipes));
                    
                    // Renderizar recetas
                    renderRecipes(recipes);
                }, 2000);
            }
            
            // Función para generar receta de ejemplo
            function generateExampleRecipe(mealType) {
                const recipes = {
                    desayuno: {
                        nombreReceta: "Batido energético de espinacas y plátano",
                        ingredientes: ["1 plátano maduro", "1 taza de espinacas frescas", "1 taza de leche fortificada", "1 cucharada de avena", "1 cucharadita de miel"],
                        preparacion: [
                            "Pelar y cortar el plátano en rodajas.",
                            "Lavar bien las espinacas.",
                            "Colocar todos los ingredientes en la licuadora.",
                            "Licuar hasta obtener una mezcla homogénea.",
                            "Servir inmediatamente."
                        ],
                        consejosDespensa: "Puedes añadir otras frutas como fresas o mango para variar el sabor. Si no tienes leche fortificada, puedes usar leche normal y añadir suplementos de hierro.",
                        beneficiosNiño: "Este batido es rico en hierro de las espinacas y vitamina C del plátano, que ayuda a absorber mejor el hierro. También proporciona energía para empezar el día.",
                        alertaAlergenos: "Contiene lácteos. Si tu hijo es alérgico a la leche, puedes sustituirla por bebida de almendras fortificada."
                    },
                    almuerzo: {
                        nombreReceta: "Lentejas con arroz y pollo",
                        ingredientes: ["1 taza de lentejas", "1/2 taza de arroz integral", "100g de pechuga de pollo", "1 zanahoria", "1 cebolla", "2 dientes de ajo", "Aceite de oliva", "Sal y pimienta"],
                        preparacion: [
                            "Cocinar las lentejas en agua con sal hasta que estén tiernas.",
                            "Cocinar el arroz integral según las instrucciones del paquete.",
                            "Cortar el pollo en cubos y saltearlo en aceite de oliva con ajo picado.",
                            "Añadir la cebolla y zanahoria picadas y cocinar hasta que estén tiernas.",
                            "Mezclar el pollo con las lentejas y servir acompañado de arroz."
                        ],
                        consejosDespensa: "Puedes añadir otras verduras como pimientos o calabacín para aumentar el valor nutricional. Si no tienes pollo, puedes sustituirlo por tofu o huevo.",
                        beneficiosNiño: "Las lentejas son una excelente fuente de hierro vegetal, y el pollo proporciona proteínas de alta calidad. Este plato es muy completo y nutritivo.",
                        alertaAlergenos: "Sin alérgenos comunes, pero siempre verifica que tus hijos no tengan alergias a los ingredientes."
                    },
                    cena: {
                        nombreReceta: "Salmón al horno con espárragos",
                        ingredientes: ["1 filete de salmón", "200g de espárragos", "1 limón", "2 cucharadas de aceite de oliva", "1 diente de ajo", "Sal y pimienta", "Eneldo fresco"],
                        preparacion: [
                            "Precalentar el horno a 200°C.",
                            "Lavar los espárragos y cortar los extremos duros.",
                            "Colocar el salmón y los espárragos en una bandeja para horno.",
                            "Rociar con aceite de oliva, ajo picado, sal y pimienta.",
                            "Exprimir el jugo de medio limón sobre el salmón.",
                            "Hornear durante 15-20 minutos.",
                            "Servir decorado con eneldo fresco y rodajas de limón."
                        ],
                        consejosDespensa: "Puedes acompañar con una porción de quinoa o arroz integral para añadir carbohidratos. Si no tienes salmón, puedes usar otro pescado rico en omega-3 como atún o trucha.",
                        beneficiosNiño: "El salmón es rico en hierro y ácidos grasos omega-3, que son importantes para el desarrollo cerebral. Los espárragos aportan fibra y vitaminas.",
                        alertaAlergenos: "Contiene pescado. Si tus hijos son alérgicos al pescado, puedes sustituir el salmón por tofu o pollo."
                    },
                    postre: {
                        nombreReceta: "Mousse de chocolate y aguacate",
                        ingredientes: ["1 aguacate maduro", "2 cucharadas de cacao en polvo sin azúcar", "1 cucharada de miel", "1/4 taza de leche de almendras fortificada", "1/2 cucharadita de extracto de vainilla"],
                        preparacion: [
                            "Cortar el aguacate por la mitad, retirar el hueso y sacar la pulpa.",
                            "Colocar la pulpa del aguacate en una batidora o procesador de alimentos.",
                            "Añadir el cacao en polvo, la miel, la leche de almendras y la vainilla.",
                            "Batir hasta obtener una crema suave y homogénea.",
                            "Refrigerar durante al menos 30 minutos antes de servir.",
                            "Decorar con frutas frescas o un poco de cacao en polvo."
                        ],
                        consejosDespensa: "Puedes añadir plátano para hacerlo más cremoso y dulce. Si no tienes leche de almendras, puedes usar cualquier otra leche vegetal fortificada.",
                        beneficiosNiño: "Este postre es rico en hierro del cacao y grasas saludables del aguacate. Es una alternativa saludable a los postres procesados.",
                        alertaAlergenos: "Sin alérgenos comunes, pero verifica que tus hijos no sean alérgicos a ninguno de los ingredientes."
                    }
                };
                
                return {
                    ...recipes[mealType],
                    tipoComida: mealType
                };
            }
            
            // Renderizar recetas
            function renderRecipes(recipes) {
                const recipeGrid = document.getElementById('recipeGrid');
                recipeGrid.innerHTML = '';
                
                if (recipes.length === 0) {
                    recipeGrid.innerHTML = '<p style="text-align: center; color: var(--gray); grid-column: 1 / -1;">No hay recetas generadas aún. ¡Genera tu primera receta!</p>';
                    return;
                }
                
                recipes.forEach((recipe, index) => {
                    const card = document.createElement('div');
                    card.classList.add('recipe-card');
                    
                    // Mapeo de tipos de comida a iconos
                    const mealIcons = {
                        desayuno: 'fa-coffee',
                        almuerzo: 'fa-hamburger',
                        cena: 'fa-moon',
                        postre: 'fa-ice-cream'
                    };
                    
                    // Mapeo de tipos de comida a nombres
                    const mealNames = {
                        desayuno: 'Desayuno',
                        almuerzo: 'Almuerzo',
                        cena: 'Cena',
                        postre: 'Postre'
                    };
                    
                    card.innerHTML = `
                        <div class="recipe-header">
                            <div>
                                <h3 class="recipe-title">${recipe.nombreReceta}</h3>
                                <p class="recipe-type"><i class="fas ${mealIcons[recipe.tipoComida]}"></i> ${mealNames[recipe.tipoComida]}</p>
                            </div>
                            <button class="btn-copy" data-index="${index}">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <div class="recipe-body">
                            <div class="recipe-section">
                                <h4 class="section-subtitle">
                                    <i class="fas fa-list"></i> Ingredientes
                                </h4>
                                <ul class="ingredient-list">
                                    ${recipe.ingredientes.map(ing => `<li>${ing}</li>`).join('')}
                                </ul>
                            </div>
                            <div class="recipe-section">
                                <h4 class="section-subtitle">
                                    <i class="fas fa-tasks"></i> Preparación
                                </h4>
                                <ol class="steps-list">
                                    ${recipe.preparacion.map(step => `<li>${step}</li>`).join('')}
                                </ol>
                            </div>
                            <div class="recipe-section">
                                <div class="tips-box">
                                    <h4 class="section-subtitle">
                                        <i class="fas fa-lightbulb"></i> Consejos para tu Despensa
                                    </h4>
                                    <p>${recipe.consejosDespensa}</p>
                                </div>
                            </div>
                            <div class="recipe-section">
                                <div class="benefits-box">
                                    <h4 class="section-subtitle">
                                        <i class="fas fa-heartbeat"></i> Beneficios para los Niños
                                    </h4>
                                    <p>${recipe.beneficiosNiño}</p>
                                </div>
                            </div>
                            ${recipe.alertaAlergenos ? `
                                <div class="recipe-section">
                                    <div class="allergy-box">
                                        <h4 class="section-subtitle">
                                            <i class="fas fa-exclamation-triangle"></i> Alerta de Alérgenos
                                        </h4>
                                        <p>${recipe.alertaAlergenos}</p>
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                    `;
                    
                    recipeGrid.appendChild(card);
                });
                
                // Configurar botones de copiar
                document.querySelectorAll('.btn-copy').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const index = parseInt(this.getAttribute('data-index'));
                        const recipe = recipes[index];
                        
                        // Crear texto para copiar
                        let textToCopy = `*${recipe.nombreReceta}*\n\n`;
                        textToCopy += `*Ingredientes:*\n`;
                        recipe.ingredientes.forEach(ing => {
                            textToCopy += `- ${ing}\n`;
                        });
                        textToCopy += `\n*Preparación:*\n`;
                        recipe.preparacion.forEach((step, i) => {
                            textToCopy += `${i + 1}. ${step}\n`;
                        });
                        textToCopy += `\n*Consejos para tu Despensa:*\n${recipe.consejosDespensa}\n\n`;
                        textToCopy += `*Beneficios para los Niños:*\n${recipe.beneficiosNiño}\n`;
                        if (recipe.alertaAlergenos) {
                            textToCopy += `\n*Alerta de Alérgenos:*\n${recipe.alertaAlergenos}`;
                        }
                        
                        // Copiar al portapapeles
                        navigator.clipboard.writeText(textToCopy).then(() => {
                            // Mostrar confirmación
                            const modal = document.getElementById('confirmModal');
                            const modalBody = document.getElementById('modalBody');
                            modalBody.textContent = '¡Receta copiada al portapapeles!';
                            modal.style.display = 'flex';
                            
                            // Configurar botones del modal
                            document.getElementById('modalCancel').style.display = 'none';
                            document.getElementById('modalConfirm').textContent = 'Aceptar';
                            document.getElementById('modalConfirm').onclick = function() {
                                modal.style.display = 'none';
                                document.getElementById('modalCancel').style.display = 'block';
                                document.getElementById('modalConfirm').textContent = 'Confirmar';
                            };
                        }).catch(err => {
                            console.error('Error al copiar al portapapeles: ', err);
                            alert('Error al copiar la receta. Por favor, inténtalo de nuevo.');
                        });
                    });
                });
            }
            
            // Cargar recetas guardadas o mostrar ejemplos iniciales
            const savedRecipes = localStorage.getItem('familyRecipes');
            if (savedRecipes) {
                renderRecipes(JSON.parse(savedRecipes));
            } else {
                // Mostrar recetas de ejemplo iniciales
                const exampleRecipes = [
                    generateExampleRecipe('desayuno'),
                    generateExampleRecipe('almuerzo'),
                    generateExampleRecipe('cena'),
                    generateExampleRecipe('postre'),
                    generateExampleRecipe('desayuno'),
                    generateExampleRecipe('almuerzo')
                ];
                renderRecipes(exampleRecipes);
            }
            
            // Configurar modal
            const modal = document.getElementById('confirmModal');
            const modalClose = document.getElementById('modalClose');
            const modalCancel = document.getElementById('modalCancel');
            const modalConfirm = document.getElementById('modalConfirm');
            
            modalClose.addEventListener('click', function() {
                modal.style.display = 'none';
            });
            
            modalCancel.addEventListener('click', function() {
                modal.style.display = 'none';
            });
            
            // Cerrar modal al hacer clic fuera
            window.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.style.display = 'none';
                }
            });
        });
    </script>
</body>
</html>
