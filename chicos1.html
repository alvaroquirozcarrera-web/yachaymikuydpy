<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comida con Despensa - YachayMikuy</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        :root {
            --primary-color: #4CAF50;
            --secondary-color: #FFC107;
            --accent-color: #FF5722;
            --light-color: #F9F9F9;
            --dark-color: #333;
            --danger-color: #F44336;
            --warning-color: #FF9800;
            --success-color: #8BC34A;
            --info-color: #03A9F4;
            --primary-blue: #2c5aa0;
            --light-blue: #5d8cc4;
            --dark-blue: #1a3a6e;
            --iron-color: #B22222;
            --vitamin-c-color: #FF8C00;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f5f5;
            color: var(--dark-color);
            line-height: 1.6;
            padding-bottom: 60px;
            background-image: url('https://picsum.photos/seed/healthyfood/1600/900.jpg');
            background-size: cover;
            background-attachment: fixed;
            background-position: center;
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.85);
            z-index: -1;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Barra superior mejorada para móviles */
        .header {
            background-color: white;
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            position: sticky;
            top: 0;
            z-index: 100;
            border: 2px solid var(--primary-color);
        }

        .header h1 {
            color: var(--primary-blue);
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.5rem;
        }

        .header h1 i {
            font-size: 1.5rem;
            color: var(--primary-color);
        }

        .header-buttons {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 10px 15px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-secondary {
            background-color: var(--secondary-color);
            color: var(--dark-color);
        }

        .btn-danger {
            background-color: var(--danger-color);
            color: white;
        }

        .btn-warning {
            background-color: var(--warning-color);
            color: white;
        }

        .btn-success {
            background-color: var(--success-color);
            color: white;
        }

        .btn-info {
            background-color: var(--info-color);
            color: white;
        }

        .btn-iron {
            background-color: var(--iron-color);
            color: white;
        }

        .btn-vitamin-c {
            background-color: var(--vitamin-c-color);
            color: white;
        }

        .btn:hover {
            opacity: 0.9;
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
        }

        /* Sección de Anemia */
        .anemia-section {
            background-color: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border: 2px solid var(--iron-color);
            position: relative;
            overflow: hidden;
        }

        .anemia-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 10px;
            height: 100%;
            background-color: var(--iron-color);
        }

        .anemia-title {
            color: var(--iron-color);
            font-size: 1.8rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .anemia-content {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            align-items: center;
        }

        .anemia-text {
            flex: 1;
            min-width: 250px;
        }

        .anemia-image {
            flex: 1;
            min-width: 250px;
            max-width: 300px;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .anemia-image img {
            width: 100%;
            height: auto;
            display: block;
        }

        /* Sección de Alimentos Recomendados */
        .recommended-foods {
            background-color: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border: 2px solid var(--success-color);
        }

        .recommended-title {
            color: var(--success-color);
            font-size: 1.5rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .food-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }

        .food-card {
            background-color: #f9f9f9;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
            cursor: pointer;
        }

        .food-card:hover {
            transform: translateY(-5px);
        }

        .food-image {
            height: 150px;
            overflow: hidden;
        }

        .food-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .food-card:hover .food-image img {
            transform: scale(1.1);
        }

        .food-info {
            padding: 15px;
        }

        .food-name {
            font-weight: bold;
            margin-bottom: 5px;
            color: var(--dark-color);
        }

        .food-benefit {
            font-size: 0.9rem;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .iron-level {
            display: flex;
            align-items: center;
            margin-top: 10px;
        }

        .iron-bar {
            flex: 1;
            height: 8px;
            background-color: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
        }

        .iron-fill {
            height: 100%;
            background-color: var(--iron-color);
        }

        .iron-percentage {
            margin-left: 10px;
            font-weight: bold;
            color: var(--iron-color);
        }

        /* Sección de Alimentos a Evitar */
        .avoid-foods {
            background-color: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border: 2px solid var(--danger-color);
        }

        .avoid-title {
            color: var(--danger-color);
            font-size: 1.5rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .avoid-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }

        .avoid-card {
            background-color: #fff9f9;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            border: 1px solid #ffe0e0;
        }

        .avoid-image {
            height: 150px;
            overflow: hidden;
            position: relative;
        }

        .avoid-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            filter: grayscale(50%);
        }

        .avoid-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: var(--danger-color);
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .avoid-info {
            padding: 15px;
        }

        .avoid-name {
            font-weight: bold;
            margin-bottom: 5px;
            color: var(--dark-color);
        }

        .avoid-reason {
            font-size: 0.9rem;
            color: var(--danger-color);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .instructions {
            background-color: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border: 2px solid var(--primary-blue);
        }

        .collapsible {
            background-color: var(--primary-blue);
            color: white;
            cursor: pointer;
            padding: 15px;
            width: 100%;
            border: none;
            text-align: left;
            outline: none;
            font-size: 1.1rem;
            border-radius: 10px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .collapsible:hover {
            background-color: var(--light-blue);
        }

        .collapsible-content {
            padding: 0 15px;
            max-height: 500px;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
            background-color: white;
            border-radius: 0 0 10px 10px;
        }

        .collapsible-content.active {
            padding: 15px;
        }

        .step {
            display: flex;
            margin-bottom: 15px;
            align-items: flex-start;
        }

        .step-number {
            background-color: var(--primary-blue);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-right: 15px;
            flex-shrink: 0;
            font-weight: bold;
        }

        .food-input {
            background-color: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border: 2px solid var(--secondary-color);
        }

        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
            overflow-x: auto;
        }

        .tab {
            padding: 12px 20px;
            cursor: pointer;
            background-color: #f1f1f1;
            border: 1px solid #ddd;
            border-bottom: none;
            border-radius: 10px 10px 0 0;
            margin-right: 5px;
            white-space: nowrap;
            transition: all 0.3s ease;
        }

        .tab.active {
            background-color: white;
            border-bottom: 1px solid white;
            margin-bottom: -1px;
            font-weight: bold;
            color: var(--primary-blue);
        }

        .tab-content {
            display: none;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 0 0 10px 10px;
        }

        .tab-content.active {
            display: block;
        }

        .input-group {
            display: flex;
            margin-bottom: 15px;
            gap: 10px;
        }

        .input-group input {
            flex: 1;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 25px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .input-group input:focus {
            border-color: var(--primary-color);
            outline: none;
        }

        .food-list {
            margin-top: 20px;
        }

        .food-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background-color: #f9f9f9;
            border-radius: 25px;
            margin-bottom: 10px;
            animation: fadeIn 0.5s;
            border-left: 4px solid var(--primary-color);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeOut {
            from { opacity: 1; transform: translateY(0); }
            to { opacity: 0; transform: translateY(-10px); }
        }

        .food-item.removing {
            animation: fadeOut 0.5s forwards;
        }

        .remove-btn {
            background-color: var(--danger-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: all 0.3s ease;
        }

        .remove-btn:hover {
            transform: rotate(90deg);
        }

        .file-upload {
            position: relative;
            display: inline-block;
            cursor: pointer;
            width: 100%;
        }

        .file-upload input[type=file] {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }

        .file-upload-btn {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            padding: 40px 20px;
            background-color: #f1f1f1;
            border: 2px dashed #ddd;
            border-radius: 10px;
            text-align: center;
            color: var(--dark-color);
            font-size: 1.2rem;
            gap: 10px;
            transition: all 0.3s ease;
        }

        .file-upload-btn:hover {
            background-color: #e9e9e9;
            border-color: var(--primary-color);
        }

        .file-upload-btn i {
            font-size: 2rem;
            color: var(--primary-color);
        }

        .recipe-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }

        .recipe-buttons .btn {
            flex: 1;
            min-width: 200px;
            justify-content: center;
        }

        .recipes-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .recipe-card {
            background-color: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            animation: fadeIn 0.5s;
            position: relative;
            overflow: hidden;
        }

        .recipe-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color), var(--info-color));
        }

        .recipe-card.removing {
            animation: fadeOut 0.5s forwards;
        }

        .recipe-card h3 {
            color: var(--primary-blue);
            margin-bottom: 15px;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .recipe-card h4 {
            margin-top: 15px;
            margin-bottom: 10px;
            color: var(--dark-color);
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .recipe-card ul, .recipe-card ol {
            margin-left: 20px;
            margin-bottom: 15px;
        }

        .recipe-card li {
            margin-bottom: 8px;
            line-height: 1.5;
        }

        .recipe-tip {
            background-color: #f0f7ff;
            border-left: 4px solid var(--info-color);
            padding: 12px;
            margin: 15px 0;
            border-radius: 0 10px 10px 0;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }

        .recipe-benefit {
            background-color: #f0fff4;
            border-left: 4px solid var(--success-color);
            padding: 12px;
            margin: 15px 0;
            border-radius: 0 10px 10px 0;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }

        .recipe-alert {
            background-color: #fff8f0;
            border-left: 4px solid var(--warning-color);
            padding: 12px;
            margin: 15px 0;
            border-radius: 0 10px 10px 0;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }

        .copy-btn {
            background-color: var(--info-color);
            color: white;
            border: none;
            border-radius: 25px;
            padding: 8px 15px;
            cursor: pointer;
            font-size: 0.9rem;
            margin-top: 10px;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: all 0.3s ease;
        }

        .copy-btn:hover {
            background-color: #0288d1;
            transform: translateY(-2px);
        }

        .loader {
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--primary-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
            display: none;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .autocomplete {
            position: relative;
        }

        .autocomplete-items {
            position: absolute;
            border: 1px solid #d4d4d4;
            border-bottom: none;
            border-top: none;
            z-index: 99;
            top: 100%;
            left: 0;
            right: 0;
            max-height: 200px;
            overflow-y: auto;
            border-radius: 0 0 10px 10px;
        }

        .autocomplete-items div {
            padding: 10px;
            cursor: pointer;
            background-color: #fff;
            border-bottom: 1px solid #d4d4d4;
        }

        .autocomplete-items div:hover {
            background-color: #e9e9e9;
        }

        .autocomplete-active {
            background-color: var(--primary-color) !important;
            color: #ffffff;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
        }

        .modal-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 500px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }

        .close {
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .close:hover {
            color: black;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
            border-top: 1px solid #eee;
            padding-top: 15px;
        }

        .development-message {
            background-color: #fff3cd;
            border: 1px solid #ffeeba;
            color: #856404;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        /* Toast container para notificaciones */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1050;
        }
        
        .custom-toast {
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            padding: 15px 20px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .toast-success {
            border-left: 5px solid var(--success-color);
        }
        
        .toast-error {
            border-left: 5px solid var(--danger-color);
        }
        
        .toast-info {
            border-left: 5px solid var(--info-color);
        }

        /* Footer para móviles */
        .mobile-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: var(--primary-blue);
            color: white;
            padding: 10px;
            display: flex;
            justify-content: space-around;
            align-items: center;
            z-index: 100;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
        }

        .mobile-footer a {
            color: white;
            text-decoration: none;
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: 0.8rem;
        }

        .mobile-footer i {
            font-size: 1.2rem;
            margin-bottom: 5px;
        }

        /* Sección de Combos Recomendados */
        .combos-section {
            background-color: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border: 2px solid var(--vitamin-c-color);
        }

        .combos-title {
            color: var(--vitamin-c-color);
            font-size: 1.5rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .combo-card {
            display: flex;
            background-color: #fff9f0;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 15px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }

        .combo-image {
            width: 120px;
            height: 120px;
            overflow: hidden;
        }

        .combo-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .combo-info {
            flex: 1;
            padding: 15px;
        }

        .combo-name {
            font-weight: bold;
            margin-bottom: 5px;
            color: var(--dark-color);
            font-size: 1.1rem;
        }

        .combo-description {
            font-size: 0.9rem;
            color: var(--dark-color);
            margin-bottom: 10px;
        }

        .combo-benefits {
            display: flex;
            gap: 10px;
        }

        .combo-benefit {
            background-color: var(--vitamin-c-color);
            color: white;
            padding: 3px 8px;
            border-radius: 15px;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 3px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .header {
                flex-direction: column;
                gap: 15px;
                padding: 15px;
            }

            .header h1 {
                font-size: 1.3rem;
            }

            .header-buttons {
                width: 100%;
                justify-content: space-between;
            }

            .recipe-buttons .btn {
                min-width: 100%;
            }

            .recipes-container {
                grid-template-columns: 1fr;
            }

            .modal-content {
                width: 95%;
                margin: 20% auto;
            }

            .mobile-footer {
                display: flex;
            }

            .anemia-content {
                flex-direction: column;
            }

            .food-grid, .avoid-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }

            .combo-card {
                flex-direction: column;
            }

            .combo-image {
                width: 100%;
                height: 150px;
            }
        }

        @media (min-width: 769px) {
            .mobile-footer {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="overlay"></div>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-shopping-basket"></i> Comida con Despensa</h1>
            <div class="header-buttons">
                <a href="#" id="backToProfile" class="btn btn-secondary"><i class="fas fa-arrow-left"></i> Volver al Perfil</a>
                <a href="index.html" class="btn btn-danger"><i class="fas fa-sign-out-alt"></i> Salir</a>
            </div>
        </div>

        <!-- Sección de Anemia -->
        <div class="anemia-section">
            <h2 class="anemia-title"><i class="fas fa-heartbeat"></i> ¿Qué es la Anemia y cómo prevenirla?</h2>
            <div class="anemia-content">
                <div class="anemia-text">
                    <p>La anemia es una condición donde el cuerpo no tiene suficientes glóbulos rojos sanos para transportar oxígeno adecuadamente. En los niños, puede causar fatiga, debilidad y problemas de desarrollo.</p>
                    <p>¡La buena noticia es que podemos prevenirla con una alimentación adecuada! Los alimentos ricos en hierro son nuestros mejores aliados.</p>
                    <div style="margin-top: 15px;">
                        <span class="btn-iron" style="padding: 5px 10px; font-size: 0.9rem; display: inline-flex; align-items: center; gap: 5px;">
                            <i class="fas fa-tint"></i> Hierro
                        </span>
                        <span style="margin: 0 10px;">+</span>
                        <span class="btn-vitamin-c" style="padding: 5px 10px; font-size: 0.9rem; display: inline-flex; align-items: center; gap: 5px;">
                            <i class="fas fa-lemon"></i> Vitamina C
                        </span>
                        <span style="margin: 0 10px;">=</span>
                        <span class="btn-success" style="padding: 5px 10px; font-size: 0.9rem; display: inline-flex; align-items: center; gap: 5px;">
                            <i class="fas fa-shield-alt"></i> Protección contra la Anemia
                        </span>
                    </div>
                </div>
                <div class="anemia-image">
                    <img src="https://picsum.photos/seed/anemia-prevention/300/200.jpg" alt="Prevención de la anemia">
                </div>
            </div>
        </div>

        <!-- Sección de Alimentos Recomendados -->
        <div class="recommended-foods">
            <h2 class="recommended-title"><i class="fas fa-check-circle"></i> Alimentos Recomendados para Prevenir la Anemia</h2>
            <div class="food-grid">
                <div class="food-card">
                    <div class="food-image">
                        <img src="https://picsum.photos/seed/spinach/200/150.jpg" alt="Espinacas">
                    </div>
                    <div class="food-info">
                        <div class="food-name">Espinacas</div>
                        <div class="food-benefit">
                            <i class="fas fa-leaf"></i> Rica en hierro y folato
                        </div>
                        <div class="iron-level">
                            <div class="iron-bar">
                                <div class="iron-fill" style="width: 85%;"></div>
                            </div>
                            <div class="iron-percentage">85%</div>
                        </div>
                    </div>
                </div>
                <div class="food-card">
                    <div class="food-image">
                        <img src="https://picsum.photos/seed/lentils/200/150.jpg" alt="Lentejas">
                    </div>
                    <div class="food-info">
                        <div class="food-name">Lentejas</div>
                        <div class="food-benefit">
                            <i class="fas fa-seedling"></i> Alta en hierro vegetal
                        </div>
                        <div class="iron-level">
                            <div class="iron-bar">
                                <div class="iron-fill" style="width: 90%;"></div>
                            </div>
                            <div class="iron-percentage">90%</div>
                        </div>
                    </div>
                </div>
                <div class="food-card">
                    <div class="food-image">
                        <img src="https://picsum.photos/seed/red-meat/200/150.jpg" alt="Carne roja">
                    </div>
                    <div class="food-info">
                        <div class="food-name">Carne roja</div>
                        <div class="food-benefit">
                            <i class="fas fa-drumstick-bite"></i> Hierro de fácil absorción
                        </div>
                        <div class="iron-level">
                            <div class="iron-bar">
                                <div class="iron-fill" style="width: 95%;"></div>
                            </div>
                            <div class="iron-percentage">95%</div>
                        </div>
                    </div>
                </div>
                <div class="food-card">
                    <div class="food-image">
                        <img src="https://picsum.photos/seed/orange/200/150.jpg" alt="Naranja">
                    </div>
                    <div class="food-info">
                        <div class="food-name">Naranja</div>
                        <div class="food-benefit">
                            <i class="fas fa-lemon"></i> Vitamina C para absorber hierro
                        </div>
                        <div class="iron-level">
                            <div class="iron-bar">
                                <div class="iron-fill" style="width: 40%;"></div>
                            </div>
                            <div class="iron-percentage">40%</div>
                        </div>
                    </div>
                </div>
                <div class="food-card">
                    <div class="food-image">
                        <img src="https://picsum.photos/seed/eggs/200/150.jpg" alt="Huevos">
                    </div>
                    <div class="food-info">
                        <div class="food-name">Huevos</div>
                        <div class="food-benefit">
                            <i class="fas fa-egg"></i> Hierro y proteínas
                        </div>
                        <div class="iron-level">
                            <div class="iron-bar">
                                <div class="iron-fill" style="width: 70%;"></div>
                            </div>
                            <div class="iron-percentage">70%</div>
                        </div>
                    </div>
                </div>
                <div class="food-card">
                    <div class="food-image">
                        <img src="https://picsum.photos/seed/strawberry/200/150.jpg" alt="Fresas">
                    </div>
                    <div class="food-info">
                        <div class="food-name">Fresas</div>
                        <div class="food-benefit">
                            <i class="fas fa-lemon"></i> Vitamina C y antioxidantes
                        </div>
                        <div class="iron-level">
                            <div class="iron-bar">
                                <div class="iron-fill" style="width: 35%;"></div>
                            </div>
                            <div class="iron-percentage">35%</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sección de Alimentos a Evitar -->
        <div class="avoid-foods">
            <h2 class="avoid-title"><i class="fas fa-times-circle"></i> Alimentos a Limitar o Evitar</h2>
            <div class="avoid-grid">
                <div class="avoid-card">
                    <div class="avoid-image">
                        <img src="https://picsum.photos/seed/coffee/200/150.jpg" alt="Café">
                        <div class="avoid-badge">Limitar</div>
                    </div>
                    <div class="avoid-info">
                        <div class="avoid-name">Café y té</div>
                        <div class="avoid-reason">
                            <i class="fas fa-exclamation-triangle"></i> Dificulta la absorción de hierro
                        </div>
                    </div>
                </div>
                <div class="avoid-card">
                    <div class="avoid-image">
                        <img src="https://picsum.photos/seed/candy/200/150.jpg" alt="Dulces">
                        <div class="avoid-badge">Evitar</div>
                    </div>
                    <div class="avoid-info">
                        <div class="avoid-name">Dulces y azúcares</div>
                        <div class="avoid-reason">
                            <i class="fas fa-exclamation-triangle"></i> Poco valor nutricional
                        </div>
                    </div>
                </div>
                <div class="avoid-card">
                    <div class="avoid-image">
                        <img src="https://picsum.photos/seed/soda/200/150.jpg" alt="Refrescos">
                        <div class="avoid-badge">Evitar</div>
                    </div>
                    <div class="avoid-info">
                        <div class="avoid-name">Refrescos</div>
                        <div class="avoid-reason">
                            <i class="fas fa-exclamation-triangle"></i> Interfiere con la absorción de nutrientes
                        </div>
                    </div>
                </div>
                <div class="avoid-card">
                    <div class="avoid-image">
                        <img src="https://picsum.photos/seed/processed-food/200/150.jpg" alt="Comida procesada">
                        <div class="avoid-badge">Limitar</div>
                    </div>
                    <div class="avoid-info">
                        <div class="avoid-name">Comida procesada</div>
                        <div class="avoid-reason">
                            <i class="fas fa-exclamation-triangle"></i> Bajo contenido de hierro
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sección de Combos Recomendados -->
        <div class="combos-section">
            <h2 class="combos-title"><i class="fas fa-magic"></i> Combos Mágicos contra la Anemia</h2>
            <div class="combo-card">
                <div class="combo-image">
                    <img src="https://picsum.photos/seed/lentil-salad/120/120.jpg" alt="Ensalada de lentejas">
                </div>
                <div class="combo-info">
                    <div class="combo-name">Ensalada de Lentejas con Pimientos</div>
                    <div class="combo-description">Lentejas ricas en hierro combinadas con pimientos rojos que aportan vitamina C.</div>
                    <div class="combo-benefits">
                        <div class="combo-benefit">
                            <i class="fas fa-tint"></i> Hierro
                        </div>
                        <div class="combo-benefit">
                            <i class="fas fa-lemon"></i> Vitamina C
                        </div>
                        <div class="combo-benefit">
                            <i class="fas fa-heart"></i> Saludable
                        </div>
                    </div>
                </div>
            </div>
            <div class="combo-card">
                <div class="combo-image">
                    <img src="https://picsum.photos/seed/spinach-omelette/120/120.jpg" alt="Tortilla de espinacas">
                </div>
                <div class="combo-info">
                    <div class="combo-name">Tortilla de Espinacas con Tomate</div>
                    <div class="combo-description">Huevos con espinacas y tomate fresco, una combinación perfecta de hierro y vitamina C.</div>
                    <div class="combo-benefits">
                        <div class="combo-benefit">
                            <i class="fas fa-tint"></i> Hierro
                        </div>
                        <div class="combo-benefit">
                            <i class="fas fa-lemon"></i> Vitamina C
                        </div>
                        <div class="combo-benefit">
                            <i class="fas fa-egg"></i> Proteína
                        </div>
                    </div>
                </div>
            </div>
            <div class="combo-card">
                <div class="combo-image">
                    <img src="https://picsum.photos/seed/beef-citrus/120/120.jpg" alt="Carne con cítricos">
                </div>
                <div class="combo-info">
                    <div class="combo-name">Carne con Salsa de Naranja</div>
                    <div class="combo-description">Carne roja (fuente de hierro hemo) con una salsa a base de naranja para maximizar la absorción.</div>
                    <div class="combo-benefits">
                        <div class="combo-benefit">
                            <i class="fas fa-tint"></i> Hierro
                        </div>
                        <div class="combo-benefit">
                            <i class="fas fa-lemon"></i> Vitamina C
                        </div>
                        <div class="combo-benefit">
                            <i class="fas fa-drumstick-bite"></i> Hierro hemo
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="instructions">
            <button class="collapsible">
                <span>Instrucciones para usar Comida con Despensa</span>
                <i class="fas fa-chevron-down"></i>
            </button>
            <div class="collapsible-content active">
                <div class="step">
                    <div class="step-number">1</div>
                    <div>Agrega tus ingredientes (manual o por foto).</div>
                </div>
                <div class="step">
                    <div class="step-number">2</div>
                    <div>Guarda tu despensa.</div>
                </div>
                <div class="step">
                    <div class="step-number">3</div>
                    <div>Genera tus recetas personalizadas.</div>
                </div>
            </div>
        </div>

        <div class="food-input">
            <div class="tabs">
                <div class="tab active" data-tab="manual">Entrada Manual</div>
                <div class="tab" data-tab="photo">Carga por Foto</div>
            </div>

            <div class="tab-content active" id="manual-tab">
                <div class="input-group">
                    <div class="autocomplete">
                        <input type="text" id="ingredient-input" placeholder="Añade un ingrediente...">
                    </div>
                    <button id="add-ingredient" class="btn btn-primary"><i class="fas fa-plus"></i> Agregar</button>
                </div>
                <div class="food-list" id="ingredients-list"></div>
            </div>

            <div class="tab-content" id="photo-tab">
                <div class="file-upload">
                    <input type="file" id="photo-upload" accept="image/*">
                    <div class="file-upload-btn">
                        <i class="fas fa-camera"></i>
                        <div>
                            <strong>Subir foto de mi despensa</strong>
                            <div>Haz clic o arrastra una imagen aquí</div>
                        </div>
                    </div>
                </div>
            </div>

            <div style="margin-top: 20px; text-align: center;">
                <button id="save-pantry" class="btn btn-success"><i class="fas fa-save"></i> Guardar mi Despensa</button>
            </div>
        </div>

        <div class="recipe-buttons">
            <button class="btn btn-primary" data-meal="desayuno"><i class="fas fa-coffee"></i> Generar Desayuno</button>
            <button class="btn btn-warning" data-meal="almuerzo"><i class="fas fa-utensils"></i> Generar Almuerzo</button>
            <button class="btn btn-info" data-meal="cena"><i class="fas fa-moon"></i> Generar Cena</button>
            <button class="btn btn-secondary" data-meal="postre"><i class="fas fa-ice-cream"></i> Generar Postre</button>
        </div>

        <div class="loader" id="loader"></div>

        <div class="recipes-container" id="recipes-container"></div>
    </div>

    <!-- Footer para móviles -->
    <div class="mobile-footer">
        <a href="#" id="mobileBackToProfile">
            <i class="fas fa-arrow-left"></i>
            <span>Volver</span>
        </a>
        <a href="#" id="mobileHome">
            <i class="fas fa-home"></i>
            <span>Inicio</span>
        </a>
        <a href="#" id="mobileProfile">
            <i class="fas fa-user"></i>
            <span>Perfil</span>
        </a>
        <a href="#" id="mobileExit">
            <i class="fas fa-sign-out-alt"></i>
            <span>Salir</span>
        </a>
    </div>

    <!-- Modal de confirmación -->
    <div id="confirm-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Confirmar acción</h3>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <p id="confirm-message">¿Estás seguro de que quieres realizar esta acción?</p>
            </div>
            <div class="modal-footer">
                <button id="confirm-cancel" class="btn btn-secondary">Cancelar</button>
                <button id="confirm-ok" class="btn btn-danger">Confirmar</button>
            </div>
        </div>
    </div>

    <!-- Toast container -->
    <div class="toast-container" id="toastContainer"></div>

    <script>
        // Lista de alimentos comunes ricos en hierro para autocompletado
        const ironRichFoods = [
            "Espinacas", "Acelgas", "Lentejas", "Garbanzos", "Frijoles", "Carne de res", "Pollo", "Pescado", 
            "Hígado", "Huevo", "Tofu", "Quinoa", "Avena", "Cereales fortificados", "Pipas de calabaza", 
            "Sésamo", "Almendras", "Nueces", "Pistachos", "Pasas", "Ciruelas pasas", "Higos secos", 
            "Remolacha", "Brócoli", "Col rizada", "Perejil", "Algas marinas", "Moluscos", "Ostras", 
            "Sardinas", "Atún", "Salmón", "Tofu", "Tempeh", "Edamame", "Soja", "Chocolate negro", 
            "Tamarindo", "Cacao en polvo", "Espirulina", "Chlorella", "Moringa", "Maca", "Cañihua", "Kiwicha"
        ];

        // Datos de ejemplo para recetas iniciales
        const sampleRecipes = [
            {
                nombreReceta: "Tortilla de Espinacas",
                ingredientes: ["3 huevos", "1 taza de espinacas frescas", "1/2 cebolla", "1 diente de ajo", "Aceite de oliva", "Sal y pimienta"],
                preparacion: ["Picar finamente la cebolla y el ajo.", "Sofreír en una sartén con aceite de oliva.", "Añadir las espinacas y cocinar hasta que se marchiten.", "Batir los huevos con sal y pimienta.", "Verter los huevos sobre las espinacas y cocinar a fuego medio.", "Voltear cuando esté cuajada por abajo."],
                consejosDespensa: "Las espinacas son ricas en hierro no hemo, que se absorbe mejor con vitamina C. Acompaña con un vaso de jugo de naranja.",
                beneficiosNiño: "Aporta hierro esencial para prevenir la anemia y fortalece el sistema inmunológico.",
                alertaAlergenos: "Contiene huevo. No recomendado para alérgicos al huevo."
            },
            {
                nombreReceta: "Lentejas con Verduras",
                ingredientes: ["1 taza de lentejas", "2 zanahorias", "1 pimiento verde", "1 tomate", "1 cebolla", "2 dientes de ajo", "1 hoja de laurel", "Aceite de oliva", "Sal"],
                preparacion: ["Poner las lentejas en remojo durante 2 horas.", "Cortar todas las verduras en trozos pequeños.", "Sofreír la cebolla y el ajo en una olla con aceite.", "Añadir el resto de verduras y cocinar 5 minutos.", "Agregar las lentejas escurridas y cubrir con agua.", "Añadir la hoja de laurel y sal. Cocinar a fuego lento 30-40 minutos."],
                consejosDespensa: "Las lentejas son una excelente fuente de hierro vegetal. Combínalas con alimentos ricos en vitamina C para mejorar su absorción.",
                beneficiosNiño: "Aporta hierro, fibra y proteínas vegetales, esenciales para el desarrollo y prevención de la anemia.",
                alertaAlergenos: "Sin alérgenos comunes. Apto para la mayoría de las dietas."
            },
            {
                nombreReceta: "Salmón al Horno con Espárragos",
                ingredientes: ["2 filetes de salmón", "1 manojo de espárragos", "1 limón", "2 dientes de ajo", "Aceite de oliva", "Sal", "Pimienta", "Eneldo fresco"],
                preparacion: ["Precalentar el horno a 200°C.", "Lavar y cortar los espárragos.", "Colocar los filetes de salmón y los espárragos en una bandeja para horno.", "Rociar con aceite de oliva, sal, pimienta y ajo picado.", "Exprimir el jugo de medio limón sobre todo.", "Hornear durante 15-20 minutos.", "Servir decorado con eneldo fresco y rodajas de limón."],
                consejosDespensa: "El salmón es rico en hierro hemo de fácil absorción y también aporta omega-3, beneficioso para el desarrollo cerebral.",
                beneficiosNiño: "Proporciona ácidos grasos omega-3, proteínas de alta calidad y hierro, fundamentales para el desarrollo cognitivo y físico.",
                alertaAlergenos: "Contiene pescado. No recomendado para alérgicos al pescado o mariscos."
            },
            {
                nombreReceta: "Ensalada de Quinoa con Remolacha",
                ingredientes: ["1 taza de quinoa", "2 remolachas medianas", "1 pepino", "1/4 taza de nueces", "2 cucharadas de aceite de oliva", "1 cucharada de vinagre de manzana", "Sal", "Pimienta"],
                preparacion: ["Cocinar la quinoa según las instrucciones del paquete y dejar enfriar.", "Cocer las remolachas hasta que estén tiernas, pelar y cortar en cubos.", "Cortar el pepino en dados pequeños.", "Triturar ligeramente las nueces.", "Mezclar la quinoa cocida con las remolachas y el pepino.", "Aliñar con aceite, vinagre, sal y pimienta.", "Espolvorear con las nueces trituradas antes de servir."],
                consejosDespensa: "La quinoa y la remolacha son excelentes fuentes de hierro. Añade perejil fresco para un extra de vitamina C.",
                beneficiosNiño: "Aporta hierro, fibra, antioxidantes y proteínas completas, apoyando el crecimiento y la prevención de la anemia.",
                alertaAlergenos: "Contiene frutos secos (nueces). No recomendado para alérgicos a frutos secos."
            },
            {
                nombreReceta: "Hígado de Pollo en Salsa",
                ingredientes: ["400g de hígado de pollo", "1 cebolla", "2 dientes de ajo", "1 tomate", "1/2 taza de caldo de pollo", "1 cucharada de harina", "Aceite de oliva", "Sal", "Pimienta", "Perejil fresco"],
                preparacion: ["Limpiar y cortar el hígado en trozos medianos.", "Picar finamente la cebolla y el ajo.", "Sofreír la cebolla y el ajo en una sartén con aceite.", "Añadir el hígado y cocinar hasta que esté dorado por fuera.", "Incorporar el tomate picado y cocinar unos minutos.", "Espolvorear la harina y remover bien.", "Añadir el caldo de pollo y cocinar a fuego lento 10 minutos.", "Sazonar con sal y pimienta, y espolvorear con perejil fresco picado."],
                consejosDespensa: "El hígado es una de las mejores fuentes de hierro hemo. Acompaña con una ensalada de vegetales frescos para añadir vitamina C.",
                beneficiosNiño: "Extremadamente rico en hierro de alta absorción y vitamina A, esencial para prevenir la anemia y apoyar la visión.",
                alertaAlergenos: "Contiene hígado de pollo. No recomendado para personas con hiperuricemia o gota."
            },
            {
                nombreReceta: "Batido de Frutas Rojas",
                ingredientes: ["1 taza de fresas", "1/2 taza de frambuesas", "1/2 taza de arándanos", "1 plátano", "1 taza de leche o bebida vegetal fortificada", "1 cucharada de semillas de chía", "Miel al gusto"],
                preparacion: ["Lavar bien todas las frutas.", "Cortar las fresas y el plátano en trozos.", "Colocar todas las frutas en la licuadora.", "Añadir la leche o bebida vegetal.", "Incorporar las semillas de chía y la miel.", "Licuar hasta obtener una mezcla homogénea.", "Servir frío."],
                consejosDespensa: "Las frutas rojas aportan vitamina C que mejora la absorción del hierro. Las semillas de chía añaden hierro extra.",
                beneficiosNiño: "Proporciona antioxidantes, vitamina C y hierro, fortaleciendo el sistema inmunológico y ayudando a prevenir la anemia.",
                alertaAlergenos: "Contiene lácteos (si se usa leche). Para opción vegana, usar bebida vegetal."
            }
        ];

        // Variables globales
        let childId = "";
        let childData = {};
        let ingredients = [];
        let recipes = [];

        // Storage Adapter - Para facilitar migración a backend
        const storageAdapter = {
            // Users
            getUsers: function() {
                const users = localStorage.getItem('yachay_users');
                return users ? JSON.parse(users) : [];
            },
            saveUsers: function(users) {
                localStorage.setItem('yachay_users', JSON.stringify(users));
            },
            
            // Children
            getChildren: function() {
                const children = localStorage.getItem('yachay_children');
                return children ? JSON.parse(children) : [];
            },
            saveChildren: function(children) {
                localStorage.setItem('yachay_children', JSON.stringify(children));
            },
            
            // Responses
            getResponses: function() {
                const responses = localStorage.getItem('yachay_responses');
                return responses ? JSON.parse(responses) : {};
            },
            saveResponses: function(responses) {
                localStorage.setItem('yachay_responses', JSON.stringify(responses));
            },
            
            // Session
            getSession: function() {
                const session = localStorage.getItem('yachay_session');
                return session ? JSON.parse(session) : { currentUserId: null, exploringAsGuest: false, lastActiveAt: null };
            },
            saveSession: function(session) {
                localStorage.setItem('yachay_session', JSON.stringify(session));
            },
            
            // Audit Log
            getAuditLog: function() {
                const auditLog = localStorage.getItem('yachay_auditLog');
                return auditLog ? JSON.parse(auditLog) : [];
            },
            saveAuditLog: function(auditLog) {
                localStorage.setItem('yachay_auditLog', JSON.stringify(auditLog));
            }
        };

        // --- INICIO DE FUNCIONES DE SINCRONIZACIÓN ---
        
        // Función para sincronizar la eliminación/restauración entre páginas
        function syncChildDeletionAcrossPages(childId, action) {
            // action puede ser 'soft-delete', 'restore' o 'permanent-delete'
            const syncData = {
                childId: childId,
                action: action,
                timestamp: new Date().toISOString()
            };
            
            // Guardar en localStorage para que otras páginas puedan detectar cambios
            localStorage.setItem('yachay_sync_action', JSON.stringify(syncData));
            
            // Notificar a otras pestañas abiertas usando BroadcastChannel
            if ('BroadcastChannel' in window) {
                const channel = new BroadcastChannel('yachay_sync');
                channel.postMessage(syncData);
            }
        }

        // --- FIN DE FUNCIONES DE SINCRONIZACIÓN ---

        // Función para mostrar notificaciones toast mejoradas
        function showToast(message, type = 'info') {
            const toastContainer = document.getElementById('toastContainer');
            const toastId = 'toast-' + Date.now();
            
            const toastHtml = `
                <div id="${toastId}" class="custom-toast toast-${type}">
                    <div class="me-2">
                        ${type === 'success' ? '<i class="fas fa-check-circle text-success"></i>' : 
                          type === 'error' ? '<i class="fas fa-exclamation-circle text-danger"></i>' : 
                          '<i class="fas fa-info-circle text-info"></i>'}
                    </div>
                    <div class="flex-grow-1">${message}</div>
                    <button type="button" class="btn-close ms-2" onclick="document.getElementById('${toastId}').remove()"></button>
                </div>
            `;
            
            toastContainer.insertAdjacentHTML('beforeend', toastHtml);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                const toast = document.getElementById(toastId);
                if (toast) toast.remove();
            }, 5000);
        }

        // Función para obtener el childId de la URL
        function getChildIdFromUrl() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('childId');
        }

        // Función para cargar los datos del niño desde localStorage
        function loadChildData() {
            const childrenData = storageAdapter.getChildren();
            const child = childrenData.find(c => c.id === childId);
            if (child) {
                childData = child;
                updateHeaderWithChildName();
                return true;
            }
            return false;
        }

        // Función para actualizar el encabezado con el nombre del niño
        function updateHeaderWithChildName() {
            const headerTitle = document.querySelector('.header h1');
            headerTitle.innerHTML = `<i class="fas fa-shopping-basket"></i> Comida con Despensa para ${childData.name}`;
            
            // Actualizar enlace de volver al perfil
            const backToProfileLink = document.getElementById('backToProfile');
            backToProfileLink.href = `chicos.html?childId=${childId}`;
            
            // Actualizar enlaces del footer móvil
            const mobileBackToProfile = document.getElementById('mobileBackToProfile');
            const mobileProfile = document.getElementById('mobileProfile');
            
            mobileBackToProfile.href = `chicos.html?childId=${childId}`;
            mobileProfile.href = `chicos.html?childId=${childId}`;
        }

        // Función para cargar los ingredientes guardados
        function loadSavedIngredients() {
            const savedIngredients = localStorage.getItem(`pantry_${childId}`);
            if (savedIngredients) {
                ingredients = JSON.parse(savedIngredients);
                renderIngredients();
            }
        }

        // Función para renderizar los ingredientes
        function renderIngredients() {
            const ingredientsList = document.getElementById('ingredients-list');
            ingredientsList.innerHTML = '';
            
            ingredients.forEach((ingredient, index) => {
                const item = document.createElement('div');
                item.className = 'food-item';
                item.innerHTML = `
                    <span>${ingredient}</span>
                    <button class="remove-btn" data-index="${index}"><i class="fas fa-times"></i></button>
                `;
                ingredientsList.appendChild(item);
            });
            
            // Añadir event listeners a los botones de eliminar
            document.querySelectorAll('.remove-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    removeIngredient(index);
                });
            });
        }

        // Función para agregar un ingrediente
        function addIngredient() {
            const input = document.getElementById('ingredient-input');
            const ingredient = input.value.trim();
            
            if (ingredient && !ingredients.includes(ingredient)) {
                ingredients.push(ingredient);
                renderIngredients();
                input.value = '';
                closeAllLists();
            }
        }

        // Función para eliminar un ingrediente
        function removeIngredient(index) {
            const item = document.querySelectorAll('.food-item')[index];
            item.classList.add('removing');
            
            setTimeout(() => {
                ingredients.splice(index, 1);
                renderIngredients();
            }, 500);
        }

        // Función para guardar la despensa
        function savePantry() {
            localStorage.setItem(`pantry_${childId}`, JSON.stringify(ingredients));
            
            // Mostrar mensaje de confirmación
            showToast('Despensa guardada correctamente', 'success');
        }

        // Función para generar recetas
        function generateRecipe(mealType) {
            // Mostrar mensaje de desarrollo
            showDevelopmentMessage();
        }

        // Función para mostrar mensaje de desarrollo
        function showDevelopmentMessage() {
            const existingMessage = document.querySelector('.development-message');
            if (existingMessage) {
                existingMessage.remove();
            }
            
            const message = document.createElement('div');
            message.className = 'development-message';
            message.innerHTML = '<i class="fas fa-tools"></i> Funcionalidad en desarrollo. Próximamente podrás generar recetas personalizadas con IA.';
            
            const recipesContainer = document.getElementById('recipes-container');
            recipesContainer.parentNode.insertBefore(message, recipesContainer);
            
            setTimeout(() => {
                message.style.animation = 'fadeOut 0.5s';
                setTimeout(() => {
                    if (message.parentNode) {
                        message.parentNode.removeChild(message);
                    }
                }, 500);
            }, 5000);
        }

        // Función para agregar una receta a la lista
        function addRecipe(recipe) {
            // Si ya hay 6 recetas, eliminar la más antigua
            if (recipes.length >= 6) {
                const oldestRecipe = document.querySelector('.recipe-card');
                if (oldestRecipe) {
                    oldestRecipe.classList.add('removing');
                    setTimeout(() => {
                        recipes.shift();
                        renderRecipes();
                    }, 500);
                }
            }
            
            recipes.push(recipe);
            renderRecipes();
        }

        // Función para renderizar las recetas
        function renderRecipes() {
            const recipesContainer = document.getElementById('recipes-container');
            recipesContainer.innerHTML = '';
            
            recipes.forEach((recipe, index) => {
                const card = document.createElement('div');
                card.className = 'recipe-card';
                
                // Generar HTML para ingredientes
                const ingredientsHtml = recipe.ingredientes.map(ing => `<li>${ing}</li>`).join('');
                
                // Generar HTML para preparación
                const preparationHtml = recipe.preparacion.map(step => `<li>${step}</li>`).join('');
                
                card.innerHTML = `
                    <h3><i class="fas fa-utensils"></i> ${recipe.nombreReceta}</h3>
                    
                    <h4><i class="fas fa-shopping-basket"></i> Ingredientes:</h4>
                    <ul>${ingredientsHtml}</ul>
                    
                    <h4><i class="fas fa-list-ol"></i> Preparación:</h4>
                    <ol>${preparationHtml}</ol>
                    
                    <div class="recipe-tip">
                        <i class="fas fa-lightbulb"></i>
                        <div>
                            <strong>Consejos para tu Despensa:</strong> ${recipe.consejosDespensa}
                        </div>
                    </div>
                    
                    <div class="recipe-benefit">
                        <i class="fas fa-heartbeat"></i>
                        <div>
                            <strong>Beneficios para el Niño:</strong> ${recipe.beneficiosNiño}
                        </div>
                    </div>
                    
                    ${recipe.alertaAlergenos ? `
                    <div class="recipe-alert">
                        <i class="fas fa-exclamation-triangle"></i>
                        <div>
                            <strong>Alerta de Alérgenos:</strong> ${recipe.alertaAlergenos}
                        </div>
                    </div>
                    ` : ''}
                    
                    <button class="copy-btn" data-recipe-index="${index}">
                        <i class="fas fa-copy"></i> Copiar Receta
                    </button>
                `;
                
                recipesContainer.appendChild(card);
            });
            
            // Añadir event listeners a los botones de copiar
            document.querySelectorAll('.copy-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const index = parseInt(this.getAttribute('data-recipe-index'));
                    copyRecipe(index);
                });
            });
        }

        // Función para copiar una receta al portapapeles
        function copyRecipe(index) {
            const recipe = recipes[index];
            
            let textToCopy = `${recipe.nombreReceta}\n\n`;
            textToCopy += `Ingredientes:\n`;
            recipe.ingredientes.forEach(ing => {
                textToCopy += `- ${ing}\n`;
            });
            
            textToCopy += `\nPreparación:\n`;
            recipe.preparacion.forEach((step, i) => {
                textToCopy += `${i + 1}. ${step}\n`;
            });
            
            textToCopy += `\nConsejos para tu Despensa: ${recipe.consejosDespensa}\n`;
            textToCopy += `Beneficios para el Niño: ${recipe.beneficiosNiño}\n`;
            
            if (recipe.alertaAlergenos) {
                textToCopy += `Alerta de Alérgenos: ${recipe.alertaAlergenos}\n`;
            }
            
            navigator.clipboard.writeText(textToCopy).then(() => {
                showToast('Receta copiada al portapapeles', 'success');
            }).catch(err => {
                showToast('Error al copiar la receta', 'error');
                console.error('Error al copiar: ', err);
            });
        }

        // Función para inicializar las recetas de ejemplo
        function initializeSampleRecipes() {
            recipes = [...sampleRecipes];
            renderRecipes();
        }

        // Función para inicializar el autocompletado
        function initAutocomplete() {
            const input = document.getElementById('ingredient-input');
            
            input.addEventListener('input', function() {
                closeAllLists();
                const val = this.value;
                
                if (!val) return false;
                
                const autocompleteList = document.createElement('div');
                autocompleteList.setAttribute('id', this.id + 'autocomplete-list');
                autocompleteList.setAttribute('class', 'autocomplete-items');
                this.parentNode.appendChild(autocompleteList);
                
                const filteredFoods = ironRichFoods.filter(food => 
                    food.toLowerCase().includes(val.toLowerCase())
                );
                
                filteredFoods.slice(0, 5).forEach(food => {
                    const item = document.createElement('div');
                    item.innerHTML = '<strong>' + food.substr(0, val.length) + '</strong>' + food.substr(val.length);
                    item.innerHTML += "<input type='hidden' value='" + food + "'>";
                    
                    item.addEventListener('click', function() {
                        input.value = this.getElementsByTagName('input')[0].value;
                        closeAllLists();
                    });
                    
                    autocompleteList.appendChild(item);
                });
            });
            
            // Cerrar la lista si se hace clic fuera
            document.addEventListener('click', function(e) {
                if (e.target !== input) {
                    closeAllLists();
                }
            });
        }

        // Función para cerrar todas las listas de autocompletado
        function closeAllLists(elmnt) {
            const items = document.getElementsByClassName('autocomplete-items');
            for (let i = 0; i < items.length; i++) {
                if (elmnt !== items[i] && elmnt !== document.getElementById('ingredient-input')) {
                    items[i].parentNode.removeChild(items[i]);
                }
            }
        }

        // Función para inicializar las pestañas
        function initTabs() {
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    // Desactivar todas las pestañas
                    tabs.forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    
                    // Activar la pestaña seleccionada
                    this.classList.add('active');
                    document.getElementById(tabId + '-tab').classList.add('active');
                });
            });
        }

        // Función para inicializar el colapsable
        function initCollapsible() {
            const coll = document.querySelector('.collapsible');
            coll.addEventListener('click', function() {
                this.classList.toggle('active');
                const content = this.nextElementSibling;
                content.classList.toggle('active');
                
                const icon = this.querySelector('i');
                if (content.classList.contains('active')) {
                    icon.classList.remove('fa-chevron-down');
                    icon.classList.add('fa-chevron-up');
                } else {
                    icon.classList.remove('fa-chevron-up');
                    icon.classList.add('fa-chevron-down');
                }
            });
        }

        // Función para inicializar el modal de confirmación
        function initModal() {
            const modal = document.getElementById('confirm-modal');
            const closeBtn = document.querySelector('.close');
            const cancelBtn = document.getElementById('confirm-cancel');
            
            closeBtn.addEventListener('click', function() {
                modal.style.display = 'none';
            });
            
            cancelBtn.addEventListener('click', function() {
                modal.style.display = 'none';
            });
            
            window.addEventListener('click', function(event) {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        }

        // Función para mostrar el modal de confirmación
        function showConfirmModal(message, onConfirm) {
            const modal = document.getElementById('confirm-modal');
            const messageEl = document.getElementById('confirm-message');
            const confirmBtn = document.getElementById('confirm-ok');
            
            messageEl.textContent = message;
            modal.style.display = 'block';
            
            // Eliminar event listeners previos
            const newConfirmBtn = confirmBtn.cloneNode(true);
            confirmBtn.parentNode.replaceChild(newConfirmBtn, confirmBtn);
            
            // Añadir nuevo event listener
            newConfirmBtn.addEventListener('click', function() {
                modal.style.display = 'none';
                if (onConfirm) onConfirm();
            });
        }

        // Función para inicializar la carga de fotos
        function initPhotoUpload() {
            const photoInput = document.getElementById('photo-upload');
            const fileUploadBtn = document.querySelector('.file-upload-btn');
            
            photoInput.addEventListener('change', function() {
                if (this.files && this.files[0]) {
                    const fileName = this.files[0].name;
                    fileUploadBtn.innerHTML = `
                        <i class="fas fa-check-circle" style="color: var(--success-color);"></i>
                        <div>
                            <strong>Imagen cargada</strong>
                            <div>${fileName}</div>
                        </div>
                    `;
                    
                    // En una implementación real, aquí se procesaría la imagen
                    // Por ahora, solo mostramos un mensaje
                    showToast('Imagen cargada correctamente. Próximamente procesaremos tus ingredientes automáticamente.', 'info');
                }
            });
        }

        // Función para inicializar el footer móvil
        function initMobileFooter() {
            // Enlace de inicio
            document.getElementById('mobileHome').addEventListener('click', function(e) {
                e.preventDefault();
                window.location.href = 'index.html';
            });
            
            // Enlace de salir
            document.getElementById('mobileExit').addEventListener('click', function(e) {
                e.preventDefault();
                window.location.href = 'index.html';
            });
        }

        // Función de inicialización
        function init() {
            // --- INICIO DE VERIFICACIÓN DE SINCRONIZACIÓN AL CARGAR ---
            // Verificar si hay acciones de sincronización pendientes de otras pestañas
            const syncAction = localStorage.getItem('yachay_sync_action');
            if (syncAction) {
                const syncData = JSON.parse(syncAction);
                // Si la acción es reciente (menos de 5 segundos), la procesamos
                const actionTime = new Date(syncData.timestamp);
                const now = new Date();
                if ((now - actionTime) < 5000) {
                    // Si la acción afecta al niño actual, redirigimos
                    const currentChildId = getChildIdFromUrl();
                    if (currentChildId === syncData.childId) {
                        if (syncData.action === 'soft-delete' || syncData.action === 'permanent-delete') {
                            showToast('El perfil actual ha sido eliminado', 'info');
                            setTimeout(() => {
                                window.location.href = 'chicos.html';
                            }, 2000);
                        }
                    }
                }
                // Limpiamos la acción para no procesarla de nuevo
                localStorage.removeItem('yachay_sync_action');
            }

            // Configurar listener para sincronización en tiempo real con otras pestañas
            if ('BroadcastChannel' in window) {
                const channel = new BroadcastChannel('yachay_sync');
                channel.onmessage = function(event) {
                    const syncData = event.data;
                    // Si recibimos un mensaje de sincronización, verificamos si afecta al niño actual
                    const currentChildId = getChildIdFromUrl();
                    if (currentChildId === syncData.childId) {
                        if (syncData.action === 'soft-delete' || syncData.action === 'permanent-delete') {
                            showToast('El perfil actual ha sido eliminado', 'info');
                            setTimeout(() => {
                                window.location.href = 'chicos.html';
                            }, 2000);
                        }
                    }
                };
            }
            // --- FIN DE VERIFICACIÓN DE SINCRONIZACIÓN AL CARGAR ---

            // Obtener el childId de la URL
            childId = getChildIdFromUrl();
            
            if (!childId) {
                showToast('No se encontró el ID del niño', 'error');
                return;
            }
            
            // Cargar los datos del niño
            if (!loadChildData()) {
                showToast('No se encontraron datos del niño', 'error');
                return;
            }
            
            // Cargar ingredientes guardados
            loadSavedIngredients();
            
            // Inicializar componentes
            initAutocomplete();
            initTabs();
            initCollapsible();
            initModal();
            initPhotoUpload();
            initMobileFooter();
            
            // Inicializar recetas de ejemplo
            initializeSampleRecipes();
            
            // Event listeners
            document.getElementById('add-ingredient').addEventListener('click', addIngredient);
            document.getElementById('ingredient-input').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    addIngredient();
                }
            });
            
            document.getElementById('save-pantry').addEventListener('click', savePantry);
            
            // Botones de generación de recetas
            document.querySelectorAll('[data-meal]').forEach(btn => {
                btn.addEventListener('click', function() {
                    const mealType = this.getAttribute('data-meal');
                    generateRecipe(mealType);
                });
            });
        }

        // Ejecutar la inicialización cuando el DOM esté cargado
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>