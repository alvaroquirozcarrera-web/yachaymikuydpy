<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cocina Inteligente contra la Anemia - Yachay Mikuy</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-color: #4CAF50; --secondary-color: #FFC107; --accent-color: #FF5722;
            --light-color: #F9F9F9; --dark-color: #333; --danger-color: #F44336;
            --warning-color: #FF9800; --success-color: #8BC34A; --info-color: #03A9F4;
            --primary-blue: #2c5aa0; --light-blue: #5d8cc4; --dark-blue: #1a3a6e;
            --iron-color: #B22222; --vitamin-c-color: #FF8C00;
            --shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { background-color: #f5f5f5; color: var(--dark-color); line-height: 1.6; padding-bottom: 80px; background-image: url('https://picsum.photos/seed/foodbg/1920/1080'); background-size: cover; background-attachment: fixed; }
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(255, 255, 255, 0.9); z-index: -1; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(10px); border-radius: 20px; padding: 20px; box-shadow: var(--shadow); display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; flex-wrap: wrap; position: sticky; top: 20px; z-index: 1000; border: 1px solid var(--primary-color); }
        .header h1 { color: var(--primary-blue); display: flex; align-items: center; gap: 10px; font-size: 1.5rem; }
        .header h1 i { color: var(--primary-color); animation: pulse 2s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
        .header-buttons { display: flex; gap: 10px; }
        .btn { padding: 12px 20px; border: none; border-radius: 25px; cursor: pointer; font-weight: bold; text-decoration: none; display: inline-flex; align-items: center; gap: 8px; transition: var(--transition); font-size: 0.9rem; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); position: relative; overflow: hidden; }
        .btn::before { content: ''; position: absolute; top: 50%; left: 50%; width: 0; height: 0; border-radius: 50%; background: rgba(255, 255, 255, 0.3); transform: translate(-50%, -50%); transition: width 0.6s, height 0.6s; }
        .btn:hover::before { width: 300px; height: 300px; }
        .btn-primary { background: linear-gradient(135deg, var(--primary-color), #45a049); color: white; }
        .btn-secondary { background: linear-gradient(135deg, var(--secondary-color), #e0a800); color: var(--dark-color); }
        .btn-danger { background: linear-gradient(135deg, var(--danger-color), #d32f2f); color: white; }
        .btn-success { background: linear-gradient(135deg, var(--success-color), #689f38); color: white; }
        .btn-info { background: linear-gradient(135deg, var(--info-color), #0288d1); color: white; }
        .btn:hover { transform: translateY(-3px); box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2); }
        .nav-tabs { display: flex; background: white; border-radius: 15px; overflow: hidden; box-shadow: var(--shadow); margin-bottom: 25px; }
        .nav-tab { flex: 1; padding: 15px; text-align: center; cursor: pointer; background: white; color: var(--dark-color); font-weight: 500; transition: var(--transition); position: relative; }
        .nav-tab i { display: block; font-size: 1.5rem; margin-bottom: 5px; }
        .nav-tab.active { background: linear-gradient(135deg, var(--primary-blue), var(--light-blue)); color: white; }
        .tab-content { display: none; animation: fadeIn 0.5s; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Anemia Section */
        .anemia-section { background: white; border-radius: 20px; padding: 25px; margin-bottom: 25px; box-shadow: var(--shadow); border-left: 10px solid var(--iron-color); }
        .anemia-title { color: var(--iron-color); font-size: 1.8rem; margin-bottom: 20px; display: flex; align-items: center; gap: 10px; }
        .anemia-intro-text { font-size: 1.1rem; color: #555; margin-bottom: 25px; }
        .anemia-intro-text strong { color: var(--danger-color); }
        .multidimensional-section { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 30px; }
        .dimension-card { background: #fafafa; padding: 20px; border-radius: 15px; border-left: 5px solid; }
        .dimension-card.nutricional { border-color: var(--success-color); }
        .dimension-card.psicologico { border-color: var(--info-color); }
        .dimension-card.cognitivo { border-color: var(--warning-color); }
        .dimension-card h4 { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; }
        .charts-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        .chart-card { background: #fafafa; padding: 20px; border-radius: 15px; box-shadow: var(--shadow); position: relative; height: 350px; }
        .chart-card canvas { max-width: 100%; }

        /* Foods Section */
        .recommended-foods, .avoid-foods { background: white; border-radius: 20px; padding: 25px; margin-bottom: 25px; box-shadow: var(--shadow); }
        .recommended-foods { border-left: 10px solid var(--success-color); }
        .avoid-foods { border-left: 10px solid var(--danger-color); }
        .section-title { font-size: 1.5rem; margin-bottom: 20px; display: flex; align-items: center; gap: 10px; }
        .recommended-title { color: var(--success-color); }
        .avoid-title { color: var(--danger-color); }
        .food-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 20px; }
        .food-card { background: white; border-radius: 15px; overflow: hidden; box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05); transition: var(--transition); cursor: pointer; border: 1px solid #eee; position: relative; }
        .food-card:hover { transform: translateY(-8px); box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1); }
        .food-image { height: 120px; overflow: hidden; position: relative; }
        .food-image img { width: 100%; height: 100%; object-fit: cover; transition: var(--transition); }
        .food-card:hover .food-image img { transform: scale(1.1); }
        .food-card-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.4); display: flex; justify-content: center; align-items: center; opacity: 0; transition: var(--transition); }
        .food-card-overlay i { color: white; font-size: 2.5rem; transition: var(--transition); }
        .food-card:hover .food-card-overlay { opacity: 1; }
        .food-card:hover .food-card-overlay i { transform: scale(1.2); }
        .food-info { padding: 15px; text-align: center; }
        .food-name { font-weight: bold; margin-bottom: 8px; font-size: 1rem; }
        .food-benefit, .avoid-reason { font-size: 0.8rem; display: flex; align-items: center; justify-content: center; gap: 5px; }
        .food-benefit { color: var(--success-color); }
        .avoid-reason { color: var(--danger-color); }
        
        /* Recipes Tab */
        .pantry-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 25px; margin-bottom: 25px; }
        .pantry-card { background: white; border-radius: 20px; padding: 25px; box-shadow: var(--shadow); }
        .pantry-card h3 { margin-bottom: 15px; color: var(--primary-blue); }
        .input-group { display: flex; margin-bottom: 15px; gap: 10px; }
        .input-group input { flex: 1; padding: 12px; border: 2px solid #ddd; border-radius: 25px; font-size: 1rem; transition: var(--transition); }
        .input-group input:focus { border-color: var(--primary-color); outline: none; }
        .file-upload-area { border: 2px dashed #ccc; border-radius: 10px; padding: 20px; text-align: center; cursor: pointer; transition: var(--transition); }
        .file-upload-area:hover { border-color: var(--primary-color); background: #f9f9f9; }
        .file-upload-area i { font-size: 2rem; color: var(--primary-color); }
        .saved-pantry-section { margin-top: 25px; }
        .saved-pantry-section h3 { margin-bottom: 15px; }
        .ingredients-list-container { display: flex; flex-wrap: wrap; gap: 10px; padding: 10px; background: #f0f8ff; border-radius: 10px; min-height: 40px; margin-bottom: 15px; }
        .food-item-tag { display: inline-flex; align-items: center; background: var(--primary-color); color: white; padding: 5px 12px; border-radius: 20px; font-size: 0.9rem; animation: fadeIn 0.3s; }
        .food-item-tag button { background: none; border: none; color: white; margin-left: 8px; cursor: pointer; font-size: 1rem; }
        #pantry-image-preview { max-width: 150px; border-radius: 10px; margin-top: 10px; box-shadow: var(--shadow); }
        .pantry-actions { display: flex; gap: 10px; margin-top: 20px; }
        .pantry-actions .btn { flex: 1; justify-content: center; }
        .recipe-buttons { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin-bottom: 25px; }
        .loader { border: 5px solid #f3f3f3; border-top: 5px solid var(--primary-color); border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 30px auto; display: none; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .recipes-container { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; }
        .recipe-card { background: white; border-radius: 20px; padding: 25px; box-shadow: var(--shadow); animation: fadeIn 0.5s; border-left: 5px solid; display: flex; flex-direction: column; }
        .recipe-card h3 { color: var(--primary-blue); margin-bottom: 15px; }
        .recipe-card h4 { margin-top: 15px; margin-bottom: 10px; }
        .recipe-card ul, .recipe-card ol { margin-left: 20px; flex-grow: 1; }
        .recipe-detail { background-color: #f8f9fa; border-left: 4px solid; padding: 12px; margin: 15px 0; border-radius: 0 10px 10px 0; display: flex; align-items: flex-start; gap: 10px; }
        .recipe-tip { border-color: var(--info-color); }
        .recipe-benefit { border-color: var(--success-color); }
        .recipe-alert { border-color: var(--warning-color); }

        /* Modal & Toasts */
        .modal { display: none; position: fixed; z-index: 1050; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.5); backdrop-filter: blur(5px); }
        .modal-content { background-color: #fefefe; margin: 10% auto; padding: 30px; border: 1px solid #888; width: 90%; max-width: 600px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); animation: slideDown 0.4s; }
        @keyframes slideDown { from { transform: translateY(-50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 10px; }
        .modal-header h3 { color: var(--primary-blue); font-size: 1.5rem; }
        .close { color: #aaa; font-size: 28px; font-weight: bold; cursor: pointer; }
        .development-message { background: linear-gradient(135deg, #fff3cd, #ffeaa7); border: 1px solid #ffeeba; color: #856404; padding: 15px; border-radius: 10px; margin: 20px 0; text-align: center; font-weight: bold; }
        .toast-container { position: fixed; top: 20px; right: 20px; z-index: 1055; }
        .custom-toast { background: white; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.2); padding: 15px 20px; margin-bottom: 10px; display: flex; align-items: center; animation: slideIn 0.3s ease; min-width: 250px; }
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        .toast-success { border-left: 5px solid var(--success-color); }
        .toast-error { border-left: 5px solid var(--danger-color); }
        .toast-info { border-left: 5px solid var(--info-color); }
        
        @media (max-width: 992px) {
            .pantry-grid { grid-template-columns: 1fr; }
            .recipes-container { grid-template-columns: 1fr; }
        }
        @media (max-width: 768px) {
             .header { flex-direction: column; gap: 15px; padding: 15px; top: 0; border-radius: 0; }
        }
    </style>
</head>
<body>
    <div class="overlay"></div>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-carrot"></i> Cocina Inteligente</h1>
            <div class="header-buttons">
                <a href="#" id="backToProfile" class="btn btn-secondary"><i class="fas fa-arrow-left"></i> Volver al Perfil</a>
                <button id="logout-btn" class="btn btn-danger"><i class="fas fa-sign-out-alt"></i> Salir</button>
            </div>
        </div>

        <div class="nav-tabs">
            <div class="nav-tab active" data-tab="anemia"><i class="fas fa-heartbeat"></i><span>Anemia</span></div>
            <div class="nav-tab" data-tab="foods"><i class="fas fa-utensils"></i><span>Alimentos</span></div>
            <div class="nav-tab" data-tab="recipes"><i class="fas fa-book-open"></i><span>Recetas</span></div>
        </div>

        <div class="tab-content active" id="anemia-tab">
            <div class="anemia-section">
                <h2 class="anemia-title"><i class="fas fa-hand-holding-medical"></i> La Anemia: Un Reto que Superaremos Juntos</h2>
                <p class="anemia-intro-text">
                    La anemia es una realidad alarmante que afecta a <strong>2 millones de niños en el Perú</strong>. No es solo cansancio; es un obstáculo que puede frenar el desarrollo cognitivo y físico de nuestros hijos. Pero con inteligencia y dedicación, podemos cambiar esta historia.
                </p>
                <h3 class="section-title" style="color: var(--primary-blue);"><i class="fas fa-cogs"></i> Un Problema Multidimensional</h3>
                <div class="multidimensional-section">
                    <div class="dimension-card nutricional">
                        <h4><i class="fas fa-leaf"></i> Nutricional</h4>
                        <p>Va más allá del hierro. Requiere un equilibrio de vitaminas y proteínas esenciales para construir un futuro fuerte.</p>
                    </div>
                    <div class="dimension-card psicologico">
                        <h4><i class="fas fa-brain"></i> Psicológico</h4>
                        <p>Un entorno positivo y la motivación familiar son claves en el camino hacia la recuperación del niño.</p>
                    </div>
                    <div class="dimension-card cognitivo">
                        <h4><i class="fas fa-child-reaching"></i> Cognitivo</h4>
                        <p>Una nutrición adecuada es vital para prevenir retrasos y potenciar el desarrollo motor y cerebral.</p>
                    </div>
                </div>
                <div class="charts-container" style="margin-top: 30px;">
                    <div class="chart-card"><h4>Fuentes Clave de Hierro</h4><canvas id="paretoChart"></canvas></div>
                    <div class="chart-card"><h4>Seguimiento Nutricional</h4><canvas id="controlChart"></canvas></div>
                </div>
            </div>
        </div>

        <div class="tab-content" id="foods-tab">
            <div class="recommended-foods">
                <h2 class="section-title recommended-title"><i class="fas fa-check-circle"></i> Alimentos para Potenciar</h2>
                <div class="food-grid">
                    <div class="food-card" data-title="Hígado de Pollo" data-description="Considerado un superalimento contra la anemia. Es la fuente más concentrada de hierro hemo, que el cuerpo absorbe con una eficiencia excepcional." data-tip="Cocínalo a la plancha con cebolla o en un paté suave para untar en pan integral. Una pequeña porción una vez por semana es suficiente.">
                        <div class="food-image">
                            <img src="https://picsum.photos/seed/liver/200/150" alt="Hígado">
                            <div class="food-card-overlay"><i class="fas fa-search-plus"></i></div>
                        </div>
                        <div class="food-info"><div class="food-name">Hígado de Pollo</div><div class="food-benefit"><i class="fas fa-star"></i> Hierro de alta potencia</div></div>
                    </div>
                    <div class="food-card" data-title="Carne de Res Magra" data-description="Excelente fuente de hierro hemo, zinc y vitamina B12, todos cruciales para la producción de glóbulos rojos y el desarrollo neurológico." data-tip="Prepara albóndigas, carne molida en salsa de tomate o tiritas salteadas con pimientos para un extra de vitamina C.">
                        <div class="food-image">
                            <img src="https://picsum.photos/seed/beef/200/150" alt="Carne de Res">
                             <div class="food-card-overlay"><i class="fas fa-search-plus"></i></div>
                        </div>
                        <div class="food-info"><div class="food-name">Carne de Res Magra</div><div class="food-benefit"><i class="fas fa-drumstick-bite"></i> Hierro fácil de absorber</div></div>
                    </div>
                    <div class="food-card" data-title="Lentejas" data-description="Las reinas de las legumbres. Repletas de hierro no hemo, fibra y proteínas vegetales que brindan energía sostenida." data-tip="Combínalas siempre con una fuente de vitamina C: un chorrito de limón al servir, pimientos en el guiso o una naranja de postre.">
                        <div class="food-image">
                            <img src="https://picsum.photos/seed/lentils/200/150" alt="Lentejas">
                            <div class="food-card-overlay"><i class="fas fa-search-plus"></i></div>
                        </div>
                        <div class="food-info"><div class="food-name">Lentejas</div><div class="food-benefit"><i class="fas fa-seedling"></i> Poder vegetal</div></div>
                    </div>
                    <div class="food-card" data-title="Espinacas" data-description="Famosas por su contenido de hierro, también aportan ácido fólico, vital para la formación de células sanguíneas." data-tip="El hierro de las espinacas se absorbe mejor cuando se cocinan. Añádelas a tortillas, cremas o batidos con frutas cítricas.">
                        <div class="food-image">
                            <img src="https://picsum.photos/seed/spinach/200/150" alt="Espinacas">
                             <div class="food-card-overlay"><i class="fas fa-search-plus"></i></div>
                        </div>
                        <div class="food-info"><div class="food-name">Espinacas</div><div class="food-benefit"><i class="fas fa-leaf"></i> Hierro y Ácido Fólico</div></div>
                    </div>
                    <div class="food-card" data-title="Brócoli" data-description="Este vegetal es un dos por uno: contiene hierro y una gran cantidad de vitamina C en el mismo paquete, facilitando su propia absorción." data-tip="Cocínalo al vapor para preservar sus nutrientes. Sírvelo como acompañamiento o en purés para los más pequeños.">
                        <div class="food-image">
                            <img src="https://picsum.photos/seed/broccoli/200/150" alt="Brócoli">
                            <div class="food-card-overlay"><i class="fas fa-search-plus"></i></div>
                        </div>
                        <div class="food-info"><div class="food-name">Brócoli</div><div class="food-benefit"><i class="fas fa-lemon"></i> Hierro + Vitamina C</div></div>
                    </div>
                    <div class="food-card" data-title="Huevo" data-description="La yema del huevo es una fuente conveniente y económica de hierro, además de aportar proteínas de alta calidad y colina para el cerebro." data-tip="Sírvelo cocido, en tortilla o revuelto. Acompáñalo con una rebanada de tomate para añadir vitamina C a la comida.">
                        <div class="food-image">
                            <img src="https://picsum.photos/seed/egg/200/150" alt="Huevo">
                            <div class="food-card-overlay"><i class="fas fa-search-plus"></i></div>
                        </div>
                        <div class="food-info"><div class="food-name">Huevo</div><div class="food-benefit"><i class="fas fa-egg"></i> Nutrición completa</div></div>
                    </div>
                </div>
            </div>

            <div class="avoid-foods">
                <h2 class="section-title avoid-title"><i class="fas fa-times-circle"></i> Alimentos a Limitar para el Niño</h2>
                <div class="food-grid">
                    <div class="avoid-card" data-title="Té y Café" data-description="Contienen compuestos llamados taninos que actúan como 'ladrones' de hierro, inhibiendo su absorción en el intestino." data-tip="Evita que el niño consuma estas bebidas. Nunca deben acompañar las comidas principales. Prioriza siempre el agua.">
                        <div class="food-image"><img src="https://picsum.photos/seed/tea/200/150" alt="Té"><div class="food-card-overlay"><i class="fas fa-search-plus"></i></div></div>
                        <div class="food-info"><div class="avoid-name">Té y Café</div><div class="avoid-reason"><i class="fas fa-ban"></i> Bloquean el hierro</div></div>
                    </div>
                    <div class="avoid-card" data-title="Gaseosas y Refrescos" data-description="Estas bebidas azucaradas contienen fosfatos que interfieren con la absorción del hierro. Además, no aportan ningún nutriente valioso." data-tip="Elimina estas bebidas de la dieta del niño. Ofrecen una falsa sensación de saciedad que le quita el apetito para alimentos nutritivos.">
                        <div class="food-image"><img src="https://picsum.photos/seed/soda/200/150" alt="Gaseosas"><div class="food-card-overlay"><i class="fas fa-search-plus"></i></div></div>
                        <div class="food-info"><div class="avoid-name">Gaseosas y Refrescos</div><div class="avoid-reason"><i class="fas fa-exclamation-triangle"></i> Interfieren con nutrientes</div></div>
                    </div>
                    <div class="avoid-card" data-title="Leche en Exceso" data-description="Aunque es vital, un consumo excesivo de leche (más de 700ml al día) puede interferir con la absorción de hierro y desplazar otros alimentos." data-tip="La leche es importante, pero no debe ser la bebida principal en las comidas. Ofrece la cantidad recomendada para su edad.">
                        <div class="food-image"><img src="https://picsum.photos/seed/milk/200/150" alt="Leche"><div class="food-card-overlay"><i class="fas fa-search-plus"></i></div></div>
                        <div class="food-info"><div class="avoid-name">Leche en Exceso</div><div class="avoid-reason"><i class="fas fa-info-circle"></i> Limita la absorción</div></div>
                    </div>
                    <div class="avoid-card" data-title="Alimentos Procesados" data-description="Suelen ser bajos en nutrientes esenciales como el hierro y altos en sodio, grasas y aditivos que el niño no necesita." data-tip="Basa la alimentación en productos frescos y naturales. Lee las etiquetas y elige opciones con pocos ingredientes.">
                        <div class="food-image"><img src="https://picsum.photos/seed/processed/200/150" alt="Procesados"><div class="food-card-overlay"><i class="fas fa-search-plus"></i></div></div>
                        <div class="food-info"><div class="avoid-name">Alimentos Procesados</div><div class="avoid-reason"><i class="fas fa-industry"></i> Bajo valor nutricional</div></div>
                    </div>
                    <div class="avoid-card" data-title="Cereales sin Preparar" data-description="Los cereales integrales y legumbres contienen fitatos que pueden reducir la absorción de hierro. ¡Pero hay solución!" data-tip="Remoja las legumbres y cereales integrales (como la avena) durante la noche. Este simple paso reduce los fitatos y mejora la disponibilidad de nutrientes.">
                        <div class="food-image"><img src="https://picsum.photos/seed/wholegrain/200/150" alt="Cereales"><div class="food-card-overlay"><i class="fas fa-search-plus"></i></div></div>
                        <div class="food-info"><div class="avoid-name">Cereales sin Preparar</div><div class="avoid-reason"><i class="fas fa-hourglass-half"></i> Contienen inhibidores</div></div>
                    </div>
                     <div class="avoid-card" data-title="Golosinas y Snacks" data-description="Aportan una gran cantidad de azúcar y calorías vacías, quitando el apetito del niño para las comidas principales que sí contienen hierro." data-tip="Ofrece frutas frescas, trocitos de queso o yogur natural como snacks. Reserva las golosinas solo para ocasiones muy especiales.">
                        <div class="food-image"><img src="https://picsum.photos/seed/candy/200/150" alt="Golosinas"><div class="food-card-overlay"><i class="fas fa-search-plus"></i></div></div>
                        <div class="food-info"><div class="avoid-name">Golosinas y Snacks</div><div class="avoid-reason"><i class="fas fa-cookie-bite"></i> Desplazan comidas reales</div></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-content" id="recipes-tab">
            <div class="pantry-grid">
                <div class="pantry-card">
                    <h3><i class="fas fa-pen-to-square"></i> Añadir a mi Despensa</h3>
                    <div class="input-group">
                        <input type="text" id="ingredient-input" placeholder="Ej: Lentejas, pollo, arroz...">
                        <button id="add-ingredient" class="btn btn-primary"><i class="fas fa-plus"></i></button>
                    </div>
                    <input type="file" id="photo-upload" accept="image/*" hidden>
                    <label for="photo-upload" class="file-upload-area">
                        <i class="fas fa-camera"></i>
                        <p>Toca para subir una foto de tu despensa</p>
                    </label>
                </div>
                 <div class="pantry-card" id="saved-pantry-section">
                    <h3><i class="fas fa-shopping-basket"></i> Mi Despensa Guardada</h3>
                    <div class="ingredients-list-container" id="ingredients-list">
                        <p style="color: #999;">Aquí aparecerán tus ingredientes...</p>
                    </div>
                    <div id="pantry-image-container"></div>
                </div>
            </div>
            <div class="pantry-actions">
                <button id="save-pantry" class="btn btn-success"><i class="fas fa-save"></i> Guardar Despensa</button>
                <button id="clear-pantry-btn" class="btn btn-danger"><i class="fas fa-trash"></i> Limpiar Despensa</button>
            </div>
            
            <h3 style="margin-top: 40px; margin-bottom: 15px; color: var(--primary-blue); text-align: center; font-size: 1.5rem;"><i class="fas fa-lightbulb"></i> Generador de Recetas con IA (Versión Demo)</h3>
            <div class="recipe-buttons">
                <button class="btn btn-primary" data-meal="desayuno"><i class="fas fa-mug-saucer"></i> Desayuno</button>
                <button class="btn btn-warning" data-meal="almuerzo"><i class="fas fa-utensils"></i> Almuerzo</button>
                <button class="btn btn-info" data-meal="cena"><i class="fas fa-moon"></i> Cena</button>
                <button class="btn btn-secondary" data-meal="postre"><i class="fas fa-ice-cream"></i> Postre</button>
            </div>

            <div id="loader" class="loader"></div>
            <div id="recipe-dev-message" style="display: none;"></div>
            <div class="recipes-container" id="recipes-container"></div>
        </div>
    </div>
    
    <div id="food-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header"><h3 id="modal-title"></h3><span class="close" id="modal-close">&times;</span></div>
            <div class="modal-body">
                <p id="modal-description"></p>
                <div class="recipe-detail recipe-tip"><i class="fas fa-lightbulb"></i><div><strong>Consejo para el niño:</strong> <span id="modal-tip"></span></div></div>
            </div>
        </div>
    </div>
    
    <div class="toast-container" id="toastContainer"></div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const sampleRecipes = {
            desayuno: [
                { name: "Batido Súper Guerrero", ingredients: ["1/2 plátano", "1/4 taza de avena", "1 taza de espinacas frescas", "1/2 taza de leche", "4 fresas"], steps: ["Lava bien las espinacas y fresas.", "Coloca todos los ingredientes en la licuadora.", "Licúa hasta obtener una mezcla homogénea y sin grumos.", "Sirve inmediatamente para aprovechar todos los nutrientes."], chefTip: "Puedes añadir una cucharadita de semillas de chía para un extra de fibra y omega-3. Si está muy espeso, añade un poco más de leche.", nutriBenefit: "El hierro de las espinacas y la avena se combina con la vitamina C de las fresas, creando una sinergia que multiplica la absorción de hierro y fortalece el sistema inmune.", allergenAlert: "Contiene lácteos. Usa leche de almendras para una versión sin lactosa." },
                { name: "Torrejas de Quinua y Manzana", ingredients: ["1/2 taza de quinua cocida", "1 huevo", "1/4 de manzana rallada", "Pizca de canela", "Aceite de coco"], steps: ["En un bol, mezcla la quinua cocida con el huevo batido, la manzana rallada y la canela.", "Calienta un poco de aceite de coco en una sartén a fuego medio.", "Vierte pequeñas porciones de la mezcla para formar torrejas.", "Cocina 2-3 minutos por cada lado, hasta que estén doradas.", "Sirve tibio."], chefTip: "Puedes acompañarlas con un poco de miel de abeja (para mayores de 1 año) o puré de frutas.", nutriBenefit: "La quinua es una proteína completa que también aporta hierro. El huevo suma más hierro y nutrientes esenciales para el cerebro del niño.", allergenAlert: "Contiene huevo. Verifica que la quinua esté bien lavada para eliminar las saponinas." },
                { name: "Huevos Revueltos con Tomate", ingredients: ["2 huevos", "1/2 tomate picado sin pepas", "1 cucharadita de aceite de oliva", "Una pizca de orégano"], steps: ["Calienta el aceite en una sartén y sofríe el tomate por un par de minutos.", "Bate los huevos en un bol y viértelos sobre el tomate.", "Revuelve constantemente con una espátula hasta que los huevos estén cocidos pero aún jugosos.", "Espolvorea una pizca de orégano antes de servir."], chefTip: "Puedes añadir trocitos de queso fresco o espinacas picadas para hacerlo aún más nutritivo.", nutriBenefit: "Un clásico potente: el hierro de la yema de huevo se absorbe mucho mejor gracias a la vitamina C del tomate. Simple, rápido y efectivo.", allergenAlert: "Contiene huevo. Es una excelente opción baja en carbohidratos." }
            ],
            almuerzo: [
                { name: "Guiso Power de Lentejas", ingredients: ["1/2 taza de lentejas (remojadas)", "1/4 de cebolla", "1/2 zanahoria", "1/4 de pimiento rojo", "1 papa pequeña"], steps: ["Sofríe la cebolla, zanahoria y pimiento picados en una olla.", "Añade las lentejas escurridas y la papa en cubos.", "Cubre con agua o caldo y cocina a fuego lento hasta que todo esté tierno.", "Puedes licuar una parte para espesar el guiso."], chefTip: "Sirve con un chorrito de limón o al lado de una ensalada de tomate para maximizar la absorción de hierro.", nutriBenefit: "Las lentejas son una fuente increíble de hierro vegetal. El pimiento rojo no solo da sabor, sino que su vitamina C es crucial para que el cuerpo aproveche ese hierro.", allergenAlert: "Libre de alérgenos comunes. Un plato fundamental en la lucha contra la anemia." },
                { name: "Tiritas de Hígado Saltado", ingredients: ["100g de hígado de pollo en tiritas", "1/4 de cebolla roja en juliana", "1/4 de tomate en juliana", "Chorrito de vinagre", "Perejil"], steps: ["Sella las tiritas de hígado en una sartén caliente con poco aceite.", "Añade la cebolla y saltea por un minuto.", "Incorpora el tomate, un chorrito de vinagre y saltea rápidamente.", "Retira del fuego y espolvorea perejil picado."], chefTip: "El secreto es una cocción muy rápida para que el hígado quede suave y no amargo. Sírvelo con arroz o puré.", nutriBenefit: "El hígado es el rey del hierro hemo, el que más fácilmente absorbe el cuerpo. Es un superalimento para reponer las reservas de hierro rápidamente.", allergenAlert: "Asegúrate de que el hígado sea fresco y de buena calidad." },
                { name: "Pescado al Vapor con Brócoli", ingredients: ["1 filete de pescado blanco", "3-4 arbolitos de brócoli", "Rodajas de limón", "Hierbas aromáticas (eneldo, perejil)"], steps: ["Coloca el filete de pescado en un plato con las rodajas de limón y hierbas.", "Pon los arbolitos de brócoli al lado.", "Cocina todo al vapor durante 10-12 minutos, hasta que el pescado esté cocido.", "Sírvelo inmediatamente."], chefTip: "El vapor es el mejor método para conservar los nutrientes. Puedes añadir otras verduras como zanahoria en bastones.", nutriBenefit: "El brócoli es un alimento estrella: aporta hierro y, a la vez, muchísima vitamina C. Esta combinación perfecta asegura una excelente nutrición.", allergenAlert: "Contiene pescado. Ideal para una cena ligera y altamente nutritiva." }
            ],
            cena: [
                { name: "Crema de Espinacas y Papa", ingredients: ["1 taza de espinacas", "1 papa amarilla pequeña", "1/4 de cebolla", "1 taza de caldo de pollo o verduras"], steps: ["Sofríe la cebolla en una olla.", "Añade la papa en cubos y el caldo. Cocina hasta que la papa esté suave.", "Agrega las espinacas y cocina solo por 1 minuto para que no pierdan su color.", "Licúa todo hasta obtener una crema suave."], chefTip: "Puedes añadir un chorrito de leche o crema para hacerla más cremosa. Sírvela con crutones integrales.", nutriBenefit: "Una forma deliciosa y fácil de que los niños coman espinacas. El ácido fólico y el hierro de esta verdura son vitales para la sangre.", allergenAlert: "Puede contener lácteos si se añade leche/crema." },
                { name: "Tortilla de Acelga", ingredients: ["4-5 hojas de acelga cocida y picada", "2 huevos", "1 cucharada de queso parmesano", "Pizca de nuez moscada"], steps: ["Exprime bien la acelga cocida para quitar el exceso de agua.", "En un bol, bate los huevos y mézclalos con la acelga, el queso y la nuez moscada.", "Cocina la tortilla en una sartén pequeña por ambos lados.", "Corta en triángulos para servir."], chefTip: "Ideal para que los niños la coman con las manos. Puedes hacerla en moldes de muffin en el horno.", nutriBenefit: "La acelga, prima de la espinaca, también es rica en hierro y vitaminas. Combinada con el huevo, se crea una cena ligera pero muy nutritiva.", allergenAlert: "Contiene huevo y lácteos." },
                { name: "Arroz Tapado de Sangrecita", ingredients: ["1/4 taza de sangrecita de pollo cocida y graneada", "1/4 de cebolla roja picada", "Ajo molido", "Ají panca molido (opcional, sin picante)", "Arroz cocido"], steps: ["Prepara un aderezo con cebolla, ajo y ají panca.", "Incorpora la sangrecita y cocínala por unos minutos.", "En un molde pequeño, coloca una capa de arroz, una capa del guiso de sangrecita y tapa con más arroz.", "Desmolda en el plato."], chefTip: "Acompaña siempre con una pequeña ensalada de cebolla y tomate o un refresco de camu camu para la vitamina C.", nutriBenefit: "La sangrecita es uno de los alimentos más recomendados para combatir la anemia por su altísimo contenido de hierro de fácil absorción.", allergenAlert: "Plato de origen peruano, muy efectivo y económico." }
            ],
            postre: [
                { name: "Mousse de Sangrecita con Chocolate", ingredients: ["100g de sangrecita cocida", "50g de chocolate bitter (>70% cacao)", "1/4 taza de leche", "Endulzante al gusto (opcional)"], steps: ["Derrite el chocolate a baño maría o en el microondas.", "Licúa la sangrecita cocida con la leche hasta que no queden grumos.", "Incorpora el chocolate derretido y sigue licuando hasta obtener una mezcla homogénea.", "Vierte en copas y refrigera por al menos 2 horas."], chefTip: "Decora con fresas o frambuesas. El sabor del chocolate enmascara por completo el de la sangrecita, ¡es un postre secreto!", nutriBenefit: "Una forma innovadora y deliciosa de darles a los niños los beneficios del hierro de la sangrecita. El cacao puro también aporta hierro y antioxidantes.", allergenAlert: "Puede contener lácteos." },
                { name: "Galletas de Avena y Lentejas", ingredients: ["1/2 taza de puré de lentejas cocidas", "1 taza de avena", "1 plátano maduro hecho puré", "1/4 taza de pasas", "Canela en polvo"], steps: ["Precalienta el horno a 180°C.", "En un bol, mezcla todos los ingredientes hasta formar una masa pegajosa.", "Con una cuchara, forma pequeñas galletas en una bandeja para horno engrasada.", "Hornea por 15-20 minutos o hasta que los bordes estén dorados."], chefTip: "Asegúrate de que las lentejas estén bien cocidas y sin sal para el puré. Son ideales para la lonchera.", nutriBenefit: "¡Una galleta que combate la anemia! Combina el hierro de las lentejas y la avena en un formato que a los niños les encanta.", allergenAlert: "Asegúrate que la avena sea libre de gluten si es necesario." },
                { name: "Helado de Remolacha y Fresa", ingredients: ["1/2 remolacha pequeña, cocida y en trozos", "1 taza de fresas congeladas", "1/2 plátano congelado", "Un chorrito de jugo de naranja"], steps: ["Asegúrate de que la fruta y la remolacha estén bien congeladas.", "Coloca todos los ingredientes en un procesador de alimentos o licuadora potente.", "Procesa hasta obtener una textura cremosa y suave, similar a un helado.", "Sirve inmediatamente."], chefTip: "Si no tienes procesador, puedes licuar y luego congelar por un par de horas, revolviendo ocasionalmente.", nutriBenefit: "La remolacha (betarraga) es conocida por su aporte de hierro y folatos. Las fresas y la naranja aportan la vitamina C necesaria para una absorción óptima.", allergenAlert: "Postre natural, vegano y libre de alérgenos comunes." }
            ]
        };

        let ingredients = [];
        const childId = new URLSearchParams(window.location.search).get('childId');
        if (!childId) { setTimeout(() => window.location.href = 'index.html', 2000); return; }
        
        function initializeApp() {
            loadChildData();
            renderCharts();
            initializeFoodModals();
            initializeTabs();
            initializePantry();
            initializeRecipeGeneration();
            initializeLogout();
        }

        function loadChildData() {
            const child = (JSON.parse(localStorage.getItem('yachay_children') || '[]')).find(c => c.id === childId);
            if (child) {
                document.querySelector('.header h1').innerHTML = `<i class="fas fa-carrot"></i> Cocina para ${child.name}`;
                document.getElementById('backToProfile').href = `chicos.html?childId=${childId}`;
            }
        }

        function showToast(message, type = 'info') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `custom-toast toast-${type}`;
            toast.innerHTML = `<div>${message}</div>`;
            container.appendChild(toast);
            setTimeout(() => toast.remove(), 4000);
        }

        function initializeTabs() {
             document.querySelectorAll('.nav-tab').forEach(tab => tab.addEventListener('click', (e) => {
                document.querySelectorAll('.nav-tab, .tab-content').forEach(el => el.classList.remove('active'));
                const tabId = e.currentTarget.dataset.tab;
                e.currentTarget.classList.add('active');
                document.getElementById(`${tabId}-tab`).classList.add('active');
            }));
        }

        function initializePantry() {
            const savedPantry = localStorage.getItem(`pantry_${childId}`);
            if (savedPantry) {
                const pantryData = JSON.parse(savedPantry);
                ingredients = pantryData.manualIngredients || [];
                if (pantryData.imageUrl) {
                    document.getElementById('pantry-image-container').innerHTML = `<img src="${pantryData.imageUrl}" id="pantry-image-preview" alt="Vista previa de despensa">`;
                }
            }
            renderPantry();

            document.getElementById('add-ingredient').addEventListener('click', () => {
                const input = document.getElementById('ingredient-input');
                const value = input.value.trim();
                if (value && !ingredients.includes(value)) {
                    ingredients.push(value);
                    renderPantry();
                    input.value = '';
                }
            });

            document.getElementById('photo-upload').addEventListener('change', (event) => {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const container = document.getElementById('pantry-image-container');
                        container.innerHTML = `<img src="${e.target.result}" id="pantry-image-preview" alt="Vista previa de despensa">`;
                    }
                    reader.readAsDataURL(file);
                    showToast('Foto cargada. La IA la analizará pronto.', 'info');
                }
            });
            
            document.getElementById('save-pantry').addEventListener('click', () => {
                const imgSrc = document.getElementById('pantry-image-preview')?.src || null;
                const pantryData = {
                    manualIngredients: ingredients,
                    imageUrl: imgSrc
                };
                localStorage.setItem(`pantry_${childId}`, JSON.stringify(pantryData));
                showToast('Despensa guardada con éxito', 'success');
            });

            document.getElementById('clear-pantry-btn').addEventListener('click', () => {
                if (confirm('¿Estás seguro de que quieres borrar todos los ingredientes y la foto de tu despensa?')) {
                    ingredients = [];
                    document.getElementById('pantry-image-container').innerHTML = '';
                    localStorage.removeItem(`pantry_${childId}`);
                    renderPantry();
                    showToast('Despensa limpiada.', 'info');
                }
            });
        }

        function renderPantry() {
            const listContainer = document.getElementById('ingredients-list');
            listContainer.innerHTML = '';
            if (ingredients.length === 0) {
                 listContainer.innerHTML = `<p style="color: #999;">Aquí aparecerán tus ingredientes...</p>`;
            } else {
                ingredients.forEach((ing, index) => {
                    const item = document.createElement('div');
                    item.className = 'food-item-tag';
                    item.innerHTML = `<span>${ing}</span><button data-index="${index}">&times;</button>`;
                    listContainer.appendChild(item);
                });
            }
            listContainer.querySelectorAll('button').forEach(btn => btn.addEventListener('click', (e) => {
                ingredients.splice(e.target.dataset.index, 1);
                renderPantry();
            }));
        }

        function initializeRecipeGeneration() {
            document.querySelectorAll('.recipe-buttons .btn').forEach(btn => btn.addEventListener('click', () => generateRecipes(btn.dataset.meal)));
        }
        
        function generateRecipes(mealType) {
            const loader = document.getElementById('loader');
            const container = document.getElementById('recipes-container');
            const devMessage = document.getElementById('recipe-dev-message');
            
            container.innerHTML = '';
            devMessage.style.display = 'none';
            loader.style.display = 'block';

            setTimeout(() => {
                loader.style.display = 'none';
                const recipesToDisplay = sampleRecipes[mealType];
                recipesToDisplay.forEach(recipe => {
                    const card = document.createElement('div');
                    card.className = 'recipe-card';
                    card.style.borderColor = mealType === 'desayuno' ? 'var(--primary-color)' : mealType === 'almuerzo' ? 'var(--warning-color)' : mealType === 'cena' ? 'var(--info-color)' : 'var(--secondary-color)';
                    card.innerHTML = `
                        <h3><i class="fas fa-utensils"></i> ${recipe.name}</h3>
                        <h4><i class="fas fa-list-check"></i> Ingredientes:</h4><ul>${recipe.ingredients.map(i => `<li>${i}</li>`).join('')}</ul>
                        <h4><i class="fas fa-shoe-prints"></i> Pasos:</h4><ol>${recipe.steps.map(s => `<li>${s}</li>`).join('')}</ol>
                        <div class="recipe-detail recipe-tip"><i class="fas fa-lightbulb"></i><div><strong>Consejo del Chef:</strong> ${recipe.chefTip}</div></div>
                        <div class="recipe-detail recipe-benefit"><i class="fas fa-heart-pulse"></i><div><strong>Beneficio Nutricional:</strong> ${recipe.nutriBenefit}</div></div>
                        <div class="recipe-detail recipe-alert"><i class="fas fa-triangle-exclamation"></i><div><strong>Alérgenos:</strong> ${recipe.allergenAlert}</div></div>
                    `;
                    container.appendChild(card);
                });
                devMessage.innerHTML = `<div class="development-message">IA en desarrollo. ¡Estas son 3 ideas nutritivas para inspirarte!</div>`;
                devMessage.style.display = 'block';
            }, 1500);
        }

        function initializeFoodModals() {
            const foodModal = document.getElementById('food-modal');
            const modalClose = document.getElementById('modal-close');
            document.querySelectorAll('.food-card, .avoid-card').forEach(card => {
                card.addEventListener('click', () => {
                    document.getElementById('modal-title').innerText = card.dataset.title;
                    document.getElementById('modal-description').innerText = card.dataset.description;
                    document.getElementById('modal-tip').innerText = card.dataset.tip;
                    foodModal.style.display = 'block';
                });
            });
            modalClose.onclick = () => foodModal.style.display = 'none';
            window.onclick = (event) => { if (event.target == foodModal) { foodModal.style.display = "none"; }};
        }

        function initializeLogout() {
            document.getElementById('logout-btn').addEventListener('click', () => {
                localStorage.removeItem('yachay_session');
                showToast('Cerrando sesión...', 'info');
                setTimeout(() => window.location.href = 'index.html', 1500);
            });
        }

        function renderCharts() {
            if(window.myParetoChart) window.myParetoChart.destroy();
            if(window.myControlChart) window.myControlChart.destroy();
            const paretoCtx = document.getElementById('paretoChart').getContext('2d');
            window.myParetoChart = new Chart(paretoCtx, { type: 'bar', data: { labels: ['Hígado', 'Carnes Rojas', 'Lentejas', 'Espinacas', 'Huevo'], datasets: [{ label: 'Aporte de Hierro (mg por porción)', data: [9.0, 3.5, 3.3, 2.7, 1.2], backgroundColor: 'rgba(178, 34, 34, 0.7)' }] }, options: { responsive: true, maintainAspectRatio: false } });
            const controlCtx = document.getElementById('controlChart').getContext('2d');
            window.myControlChart = new Chart(controlCtx, { type: 'line', data: { labels: ['Lunes', 'Martes', 'Miérc', 'Jueves', 'Viernes'], datasets: [{ label: 'Consumo Actual (mg)', data: [7, 8, 6, 9, 7.5], borderColor: 'rgba(3, 169, 244, 1)', tension: 0.1 }, { label: 'Recomendado (mg)', data: [8, 8, 8, 8, 8], borderColor: 'rgba(255, 152, 0, 1)', borderDash: [5, 5] }] }, options: { responsive: true, maintainAspectRatio: false } });
        }
        
        initializeApp();
    });
    </script>
</body>
</html>